<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Divya Center - MultiTool Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        /* --- Root Variables & Base Styles --- */
        :root {
            --main-bg-color: #0d0f14;
            --navbar-bg: #1c222d;
            --sidebar-bg: #12151a;
            --text-primary: #ffffff;
            --text-secondary: #e0e0e0;
            --accent-cyan: #42f8f5;
            --glow-shadow-color: rgba(66, 248, 245, 0.6);
            --glow-shadow-weak: rgba(66, 248, 245, 0.3);
            --button-bg: #12151a;
            --card-bg: #151920; /* Slightly lighter than sidebar */

            --font-main: 'Orbitron', sans-serif;
            --transition-speed: 0.3s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--main-bg-color);
            color: var(--text-secondary);
            line-height: 1.6;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        h1, h2, h3, h4, h5, h6 {
            color: var(--text-primary);
            font-weight: 700; /* Bold headings */
            margin-bottom: 0.8rem;
        }

        a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color var(--transition-speed) ease;
        }

        a:hover, .glow-text-hover:hover {
            color: var(--accent-cyan);
            text-shadow: 0 0 5px var(--accent-cyan), 0 0 10px var(--glow-shadow-color);
        }

        button {
            font-family: var(--font-main);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            border: none;
            background: none;
            color: var(--text-primary);
        }

        .container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .main-wrapper {
            display: flex;
            flex-grow: 1;
        }

        /* --- Glow Effects --- */
        .glow-text {
            color: var(--accent-cyan);
            text-shadow: 0 0 8px var(--accent-cyan), 0 0 15px var(--glow-shadow-color), 0 0 20px var(--glow-shadow-color);
        }

        /* --- Navbar --- */
        .navbar {
            background-color: var(--navbar-bg);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3), 0 0 10px var(--glow-shadow-weak) inset;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo-icon {
            font-size: 2rem;
            color: var(--accent-cyan);
            margin-right: 0.75rem;
            text-shadow: 0 0 8px var(--accent-cyan);
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 900; /* Extra bold for logo */
            color: var(--text-primary);
            margin-bottom: 0;
        }
        .logo h1 span {
            font-weight: 400;
            color: var(--text-secondary);
        }

        .nav-links {
            display: flex;
        }

        .nav-links a {
            color: var(--text-secondary);
            margin-left: 1.5rem;
            padding-bottom: 0.5rem;
            position: relative;
            font-weight: 700;
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background-color: var(--accent-cyan);
            box-shadow: 0 0 5px var(--accent-cyan);
            transition: width var(--transition-speed) ease;
        }

        .nav-links a:hover::after,
        .nav-links a.active::after {
            width: 100%;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--accent-cyan);
            text-shadow: 0 0 5px var(--accent-cyan);
        }

        .hamburger-menu {
            display: none; /* Hidden on desktop */
            font-size: 1.5rem;
            color: var(--text-primary);
        }

        /* --- Sidebar --- */
        .sidebar {
            background-color: var(--sidebar-bg);
            width: 280px;
            padding: 1.5rem 1rem;
            transition: transform var(--transition-speed) ease-in-out, width var(--transition-speed) ease-in-out;
            box-shadow: 2px 0 10px rgba(0,0,0,0.3), 0 0 10px var(--glow-shadow-weak) inset;
            overflow-y: auto;
            position: relative; 
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(66, 248, 245, 0.2);
        }
        .sidebar-header h2 {
            font-size: 1.2rem;
            margin-bottom: 0;
        }
        .sidebar-toggle-btn {
            font-size: 1.2rem;
            color: var(--text-secondary);
            padding: 0.3rem;
        }
        .sidebar-toggle-btn:hover {
            color: var(--accent-cyan);
        }
        .sidebar.collapsed .sidebar-toggle-btn i {
            transform: rotate(180deg);
        }
        .sidebar.collapsed {
            width: 60px; 
            padding: 1.5rem 0.5rem;
        }
        .sidebar.collapsed .sidebar-header h2,
        .sidebar.collapsed .category-toggle span:not(.category-icon), 
        .sidebar.collapsed .tool-list,
        .sidebar.collapsed .toggle-arrow,
        .sidebar.collapsed .tool-list a > *:not(i:first-child) { /* Hides text in tool links */
            display: none;
        }
        .sidebar.collapsed .category-toggle,
        .sidebar.collapsed .tool-list a {
            justify-content: center;
        }
        .sidebar.collapsed .category-icon,
        .sidebar.collapsed .tool-list a i:first-child {
            margin-right: 0;
        }

        .tool-categories > li {
            margin-bottom: 0.5rem;
            list-style-type: none;
        }

        .category-toggle {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 0.75rem 0.5rem;
            text-align: left;
            font-size: 1rem;
            font-weight: 700;
            border-radius: 4px;
        }
        .category-toggle:hover {
            background-color: rgba(66, 248, 245, 0.1);
            color: var(--accent-cyan);
        }
        .category-toggle .category-icon {
            margin-right: 0.75rem;
            font-size: 1.1rem;
            width: 20px; 
            text-align: center;
        }
        .category-toggle .toggle-arrow {
            margin-left: auto;
            transition: transform var(--transition-speed) ease;
        }
        .category-toggle.active .toggle-arrow {
            transform: rotate(180deg);
        }

        .tool-list {
            list-style-type: none;
            padding-left: 1rem; 
            max-height: 0;
            overflow: hidden;
            transition: max-height var(--transition-speed) ease-out;
        }
        .tool-list.open {
            /* max-height set by JS */
        }

        .tool-list li a {
            display: flex;
            align-items: center;
            padding: 0.6rem 0.5rem;
            color: var(--text-secondary);
            border-radius: 4px;
            font-size: 0.9rem;
        }
        .tool-list li a i:first-child {
            margin-right: 0.75rem;
            width: 18px; 
            text-align: center;
            color: var(--accent-cyan);
            opacity: 0.7;
        }
        .tool-list li a:hover {
            background-color: var(--button-bg);
            color: var(--accent-cyan);
            box-shadow: 0 0 8px var(--glow-shadow-weak) inset;
        }
        .tool-list li a:hover i {
            opacity: 1;
            text-shadow: 0 0 5px var(--accent-cyan);
        }

        /* --- Main Content Area --- */
        .main-content {
            flex-grow: 1;
            padding: 2rem;
            overflow-y: auto; 
        }

        .hero-section {
            text-align: center;
            padding: 4rem 1rem;
            margin-bottom: 3rem;
            border-radius: 8px;
            background: linear-gradient(145deg, rgba(28,34,45,0.8), rgba(13,15,20,0.9)), url('https://source.unsplash.com/random/1200x400/?futuristic,technology,abstract,cyber') center/cover no-repeat; 
            box-shadow: 0 0 20px var(--glow-shadow-weak);
        }
        .hero-section h2 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        .hero-section p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 2rem auto;
            color: var(--text-primary);
        }

        .cta-button, .open-tool-btn, .modal-content button:not(.modal-close-btn),
        .tool-ui-button { /* General class for buttons within tool UI */
            background-color: var(--button-bg);
            color: var(--text-primary);
            padding: 0.8rem 1.5rem;
            border: 1px solid var(--accent-cyan);
            border-radius: 5px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 5px transparent, 0 0 0px transparent inset; 
            transition: all var(--transition-speed) ease;
        }
        .cta-button i, .open-tool-btn i {
            margin-left: 0.5rem;
        }

        .cta-button:hover, .open-tool-btn:hover, .modal-content button:not(.modal-close-btn):hover,
        .tool-ui-button:hover {
            background-color: var(--accent-cyan);
            color: var(--main-bg-color);
            box-shadow: 0 0 10px var(--accent-cyan), 0 0 20px var(--glow-shadow-color), 0 0 5px var(--accent-cyan) inset;
            border-color: var(--accent-cyan);
        }

        .tools-grid-section {
            margin-bottom: 3rem;
        }
        .tools-grid-section h3 {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
            padding-bottom: 0.5rem;
        }
        .tools-grid-section h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background-color: var(--accent-cyan);
            box-shadow: 0 0 8px var(--accent-cyan);
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 1.5rem;
        }

        .tool-card {
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border: 1px solid transparent; 
            transition: all var(--transition-speed) ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-cyan);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3), 0 0 15px var(--glow-shadow-color);
        }

        .tool-card .tool-icon {
            font-size: 2.5rem;
            color: var(--accent-cyan);
            margin-bottom: 1rem;
            display: block;
            text-shadow: 0 0 8px var(--accent-cyan);
        }

        .tool-card h4 {
            font-size: 1.3rem;
            color: var(--text-primary);
        }

        .tool-card p {
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
            flex-grow: 1; 
            min-height: 40px; 
        }

        .content-section {
            padding: 2rem;
            margin-bottom: 2rem;
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .content-section h3 {
            font-size: 1.8rem;
            border-bottom: 2px solid var(--accent-cyan);
            padding-bottom: 0.5rem;
            display: inline-block;
            box-shadow: 0 2px 5px var(--glow-shadow-weak);
        }

        /* --- Footer --- */
        .footer {
            background-color: var(--sidebar-bg); 
            color: var(--text-secondary);
            padding: 1.5rem 2rem;
            text-align: center;
            border-top: 2px solid var(--accent-cyan);
            box-shadow: 0 -2px 10px var(--glow-shadow-color);
        }
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .footer p {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        .footer-links {
            margin-bottom: 0.5rem;
        }
        .footer-links a {
            margin: 0 0.5rem;
            font-size: 0.9rem;
        }
        .social-icons a {
            font-size: 1.2rem;
            margin: 0 0.75rem;
            color: var(--text-secondary);
        }
        .social-icons a:hover {
            color: var(--accent-cyan);
            transform: scale(1.1);
            text-shadow: 0 0 8px var(--accent-cyan);
        }

        /* --- Modal Styles --- */
        .modal {
            display: none; 
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(13, 15, 20, 0.8); 
            backdrop-filter: blur(5px);
            opacity: 0;
            transition: opacity var(--transition-speed) ease-in-out;
        }
        .modal.open {
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
        }

        .modal-content {
            background-color: var(--navbar-bg); 
            margin: auto;
            padding: 2rem;
            border: 1px solid var(--accent-cyan);
            border-radius: 8px;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 0 25px var(--glow-shadow-color), 0 0 15px var(--accent-cyan) inset;
            position: relative;
            transform: scale(0.95) translateY(-20px);
            opacity: 0;
            transition: transform var(--transition-speed) ease-out, opacity var(--transition-speed) ease-out;
            max-height: 90vh; 
            overflow-y: auto;
        }
        .modal.open .modal-content {
            transform: scale(1) translateY(0);
            opacity: 1;
        }

        .modal-close-btn {
            color: var(--text-secondary);
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            font-size: 2rem;
            font-weight: bold;
            line-height: 1;
        }
        .modal-close-btn:hover,
        .modal-close-btn:focus {
            color: var(--accent-cyan);
            text-decoration: none;
            cursor: pointer;
            text-shadow: 0 0 5px var(--accent-cyan);
        }

        #modalToolTitle {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--accent-cyan);
            font-size: 1.8rem;
        }

        #modalToolContent {
            margin-bottom: 1.5rem;
            min-height: 150px; 
        }
        /* Styles for tool-specific inputs */
        .tool-input-group {
            margin-bottom: 1rem;
        }
        .tool-input-group label {
            display: block;
            margin-bottom: 0.3rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        .tool-input-group input[type="text"],
        .tool-input-group input[type="number"],
        .tool-input-group input[type="date"],
        .tool-input-group textarea,
        .tool-input-group select {
            width: 100%;
            padding: 0.6rem;
            background: var(--main-bg-color);
            color: var(--text-primary);
            border: 1px solid var(--accent-cyan);
            border-radius: 4px;
            font-family: var(--font-main);
            font-size: 1rem;
        }
        /* Style date input to show picker icon */
        .tool-input-group input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1) sepia(1) saturate(5) hue-rotate(130deg); /* Make it cyan-ish */
            cursor: pointer;
        }

        .tool-input-group input[type="number"]::-webkit-outer-spin-button,
        .tool-input-group input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .tool-input-group input[type="number"] {
            -moz-appearance: textfield; /* Firefox */
        }
        .tool-input-group .input-suffix {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        .tool-input-group_inline {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .tool-input-group_inline input {
            flex-grow: 1;
        }
        .unit-converter-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 1rem;
            align-items: center; /* Vertically center items in grid cells */
            margin-bottom: 1rem;
        }
        .unit-converter-grid .tool-input-group input, 
        .unit-converter-grid .tool-input-group select {
            margin-bottom: 0; /* remove default margin from tool-input-group */
        }
        .unit-converter-grid .swap-btn-container {
            display: flex;
            justify-content: center;
            align-items: center;
        }
         .unit-converter-grid .swap-btn-container button {
            padding: 0.5rem;
            font-size: 1.2rem;
            line-height: 1;
            border-radius: 50%;
        }


        .file-drop-area {
            border: 2px dashed var(--accent-cyan);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 1rem;
            background-color: rgba(66, 248, 245, 0.05);
            transition: background-color var(--transition-speed) ease;
        }
        .file-drop-area.dragover {
            background-color: rgba(66, 248, 245, 0.15);
            box-shadow: 0 0 10px var(--glow-shadow-weak) inset;
        }
        .file-drop-area p {
            margin-bottom: 0.5rem;
        }
        .file-drop-area input[type="file"] {
            display: none; 
        }
        .file-preview {
            margin-top: 1rem;
            text-align: left;
            max-height: 150px; 
            overflow-y: auto; 
            margin-bottom:1rem; 
            border: 1px solid var(--sidebar-bg); 
            padding: 0.5rem; 
            border-radius: 4px;
        }
        .file-preview div { /* Style for individual file preview items */
            margin-bottom: 0.5rem;
            padding: 0.25rem;
            background: var(--main-bg-color);
            border-radius: 3px;
            display: flex;
            align-items: center;
        }
        .file-preview img {
            max-width: 50px;
            max-height: 50px;
            margin-right: 10px;
            border: 1px solid var(--accent-cyan);
            border-radius: 4px;
            vertical-align: middle;
        }
         .file-preview audio, .file-preview video {
            max-width: 100%;
            display: block;
            margin-top: 0.5rem;
            border-radius: 4px;
            border: 1px solid var(--accent-cyan);
        }


        .tool-results-area {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: var(--main-bg-color);
            border: 1px solid var(--accent-cyan);
            border-radius: 5px;
            box-shadow: 0 0 10px var(--glow-shadow-weak) inset;
        }
        .tool-results-area p {
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        .tool-results-area strong {
            color: var(--accent-cyan);
            font-weight: 700;
        }
        .tool-results-area .age-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.5rem;
        }
        .tool-results-area .age-summary-grid p {
            margin-bottom: 0.2rem;
        }


        /* Timer/Stopwatch Styles */
        .timer-stopwatch-tabs {
            display: flex;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--accent-cyan);
        }
        .timer-stopwatch-tabs button {
            flex-grow: 1;
            padding: 0.75rem 0.5rem;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: none;
            background-color: transparent;
            color: var(--text-secondary);
            position: relative;
        }
        .timer-stopwatch-tabs button.active {
            color: var(--accent-cyan);
            font-weight: bold;
        }
        .timer-stopwatch-tabs button.active::after {
            content: '';
            position: absolute;
            bottom: -1px; /* Align with border-bottom of parent */
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--accent-cyan);
            box-shadow: 0 0 8px var(--accent-cyan);
        }
        .timer-stopwatch-panel {
            display: none;
        }
        .timer-stopwatch-panel.active {
            display: block;
        }
        .time-display {
            font-size: 3rem;
            font-weight: 900;
            text-align: center;
            color: var(--accent-cyan);
            text-shadow: 0 0 10px var(--glow-shadow-color);
            margin: 1.5rem 0;
            letter-spacing: 2px;
            padding: 1rem;
            background-color: var(--main-bg-color);
            border-radius: 5px;
            border: 1px solid var(--accent-cyan);
        }
        .timer-inputs {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            align-items: center;
            margin-bottom: 1rem;
        }
        .timer-inputs input[type="number"] {
            width: 70px;
            text-align: center;
            font-size: 1.2rem;
        }
        .timer-controls, .stopwatch-controls {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            margin-bottom: 1rem;
        }
        .timer-controls button, .stopwatch-controls button {
            padding: 0.6rem 1.2rem; /* Slightly smaller padding for these buttons */
            font-size: 0.9rem;
        }
        .laps-list {
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid var(--sidebar-bg);
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        .laps-list li {
            padding: 0.3rem 0;
            border-bottom: 1px dashed rgba(255,255,255,0.1);
            list-style-position: inside;
            list-style-type: decimal;
        }
        .laps-list li:last-child {
            border-bottom: none;
        }


        .tool-status {
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
            display: none; 
        }
        .tool-status.processing {
            background-color: rgba(255, 165, 0, 0.2); 
            border: 1px solid orange;
            color: orange;
        }
        .tool-status.success {
            background-color: rgba(66, 248, 245, 0.2); 
            border: 1px solid var(--accent-cyan);
            color: var(--accent-cyan);
        }
        .tool-status.error {
            background-color: rgba(255, 0, 0, 0.2); 
            border: 1px solid red;
            color: red;
        }
        .tool-status.info { /* Added for STT stop without error */
            background-color: rgba(0, 100, 255, 0.2); 
            border: 1px solid #007bff;
            color: #007bff;
        }


        /* --- Responsive Design --- */
        @media (max-width: 992px) { /* Tablet */
            .tools-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            }
        }

        @media (max-width: 768px) { /* Mobile */
            .navbar {
                padding: 1rem;
            }
            .nav-links {
                display: none; 
                flex-direction: column;
                position: absolute;
                top: 100%; 
                left: 0;
                width: 100%;
                background-color: var(--navbar-bg);
                padding: 1rem 0;
                box-shadow: 0 5px 10px rgba(0,0,0,0.2);
                border-top: 1px solid var(--accent-cyan);
            }
            .nav-links.active {
                display: flex; 
            }
            .nav-links a {
                margin: 0.5rem 1rem;
                text-align: center;
            }
            .hamburger-menu {
                display: block;
            }

            .main-wrapper {
                flex-direction: column; 
            }
            .sidebar {
                width: 100%; 
                max-height: 50vh; 
                overflow-y: auto;
                position: static; 
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            }
             .sidebar-toggle-btn { 
                display: none; 
            }
            .sidebar.collapsed { 
                width: 100%;
                padding: 1.5rem 1rem; 
            }
            .sidebar.collapsed .sidebar-header h2,
            .sidebar.collapsed .category-toggle span:not(.category-icon),
            .sidebar.collapsed .tool-list,
            .sidebar.collapsed .toggle-arrow,
            .sidebar.collapsed .tool-list a > *:not(i:first-child) {
                display: inline-block; 
            }
            .sidebar.collapsed .category-toggle,
            .sidebar.collapsed .tool-list a {
                justify-content: flex-start; 
            }
             .sidebar.collapsed .category-icon,
            .sidebar.collapsed .tool-list a i:first-child {
                margin-right: 0.75rem; 
            }

            .hero-section h2 {
                font-size: 2.2rem;
            }
            .hero-section p {
                font-size: 1rem;
            }
            .tools-grid {
                grid-template-columns: 1fr; 
            }
            .main-content {
                padding: 1rem;
            }
            .modal-content {
                width: 95%;
                padding: 1.5rem;
            }
            #modalToolTitle {
                font-size: 1.5rem;
            }
            .footer-content {
                flex-direction: column;
            }
            .footer-links, .social-icons {
                margin-top: 0.5rem;
            }
            .time-display {
                font-size: 2.2rem;
            }
            .timer-inputs input[type="number"] {
                width: 60px;
                font-size: 1rem;
            }
            .unit-converter-grid {
                grid-template-columns: 1fr; /* Stack on mobile */
            }
            .unit-converter-grid .swap-btn-container {
                grid-row: 2; /* Move swap button between inputs on mobile stack */
                margin: 0.5rem 0;
            }
            .unit-converter-grid .swap-btn-container button {
                 transform: rotate(90deg); /* Rotate swap icon for vertical flow */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 1. Top Navbar (Header) -->
        <header class="navbar">
            <div class="logo">
                <i class="fas fa-brain logo-icon"></i>
                <h1>Divya Center <span>- MultiTool Hub</span></h1>
            </div>
            <nav class="nav-links">
                <a href="#home" class="nav-link active">Home</a>
                <a href="#tools" class="nav-link">Tools</a>
                <a href="#about" class="nav-link">About</a>
                <a href="#contact" class="nav-link">Contact</a>
            </nav>
            <button class="hamburger-menu" aria-label="Toggle navigation">
                <i class="fas fa-bars"></i>
            </button>
        </header>

        <div class="main-wrapper">
            <!-- 2. Left Side Vertical Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <h2>Tool Categories</h2>
                    <button class="sidebar-toggle-btn" aria-label="Toggle Sidebar">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                </div>
                <ul class="tool-categories">
                    <li>
                        <button class="category-toggle">
                            <i class="fas fa-file-pdf category-icon"></i> <span>PDF Tools</span> <i class="fas fa-chevron-down toggle-arrow"></i>
                        </button>
                        <ul class="tool-list">
                            <li><a href="#" data-tool="merge-pdf"><i class="fas fa-object-group"></i> <span>Merge PDF</span></a></li>
                            <li><a href="#" data-tool="split-pdf"><i class="fas fa-columns"></i> <span>Split PDF</span></a></li>
                            <li><a href="#" data-tool="compress-pdf"><i class="fas fa-compress-arrows-alt"></i> <span>Compress PDF</span></a></li>
                            <li><a href="#" data-tool="pdf-to-word"><i class="fas fa-file-word"></i> <span>PDF to Word</span></a></li>
                            <li><a href="#" data-tool="pdf-to-jpg"><i class="fas fa-file-image"></i> <span>PDF to JPG</span></a></li>
                            <li><a href="#" data-tool="unlock-pdf"><i class="fas fa-unlock-alt"></i> <span>Unlock PDF</span></a></li>
                            <li><a href="#" data-tool="word-to-pdf"><i class="fas fa-file-pdf"></i> <span>Word to PDF</span></a></li>
                            <li><a href="#" data-tool="pdf-to-ppt"><i class="fas fa-file-powerpoint"></i> <span>PDF to PowerPoint</span></a></li>
                            <li><a href="#" data-tool="ppt-to-pdf"><i class="fas fa-file-pdf"></i> <span>PowerPoint to PDF</span></a></li>
                            <li><a href="#" data-tool="pdf-to-excel"><i class="fas fa-file-excel"></i> <span>PDF to Excel</span></a></li>
                            <li><a href="#" data-tool="excel-to-pdf"><i class="fas fa-file-pdf"></i> <span>Excel to PDF</span></a></li>
                            <li><a href="#" data-tool="jpg-to-pdf"><i class="fas fa-file-pdf"></i> <span>JPG to PDF</span></a></li>
                            <li><a href="#" data-tool="organize-pdf"><i class="fas fa-sort-amount-down"></i> <span>Organize PDF</span></a></li>
                            <li><a href="#" data-tool="edit-pdf"><i class="fas fa-edit"></i> <span>Edit PDF (Text/Images)</span></a></li>
                            <li><a href="#" data-tool="rotate-pdf"><i class="fas fa-sync-alt"></i> <span>Rotate PDF</span></a></li>
                            <li><a href="#" data-tool="protect-pdf"><i class="fas fa-lock"></i> <span>Protect PDF</span></a></li>
                            <li><a href="#" data-tool="add-page-numbers"><i class="fas fa-list-ol"></i> <span>Add Page Numbers</span></a></li>
                            <li><a href="#" data-tool="add-watermark"><i class="fas fa-tint"></i> <span>Add Watermark</span></a></li>
                        </ul>
                    </li>
                    <li>
                        <button class="category-toggle">
                            <i class="fas fa-image category-icon"></i> <span>Image Tools</span> <i class="fas fa-chevron-down toggle-arrow"></i>
                        </button>
                        <ul class="tool-list">
                            <li><a href="#" data-tool="image-compressor"><i class="fas fa-compress"></i> <span>Image Compressor</span></a></li>
                            <li><a href="#" data-tool="image-converter"><i class="fas fa-exchange-alt"></i> <span>Image Converter</span></a></li>
                        </ul>
                    </li>
                    <li>
                        <button class="category-toggle">
                            <i class="fas fa-font category-icon"></i> <span>Text Tools</span> <i class="fas fa-chevron-down toggle-arrow"></i>
                        </button>
                        <ul class="tool-list">
                            <li><a href="#" data-tool="word-counter"><i class="fas fa-calculator"></i> <span>Word & Char Counter</span></a></li>
                            <li><a href="#" data-tool="text-to-speech"><i class="fas fa-volume-up"></i> <span>Text to Speech</span></a></li>
                            <li><a href="#" data-tool="speech-to-text"><i class="fas fa-microphone-alt"></i> <span>Speech to Text</span></a></li>
                            <li><a href="#" data-tool="json-formatter"><i class="fas fa-code"></i> <span>JSON Formatter</span></a></li>
                        </ul>
                    </li>
                    <li>
                        <button class="category-toggle">
                            <i class="fas fa-cogs category-icon"></i> <span>Utility Tools</span> <i class="fas fa-chevron-down toggle-arrow"></i>
                        </button>
                        <ul class="tool-list">
                            <li><a href="#" data-tool="audio-converter"><i class="fas fa-file-audio"></i> <span>Audio Converter</span></a></li>
                            <li><a href="#" data-tool="video-compressor"><i class="fas fa-video"></i> <span>Video Compressor</span></a></li>
                            <li><a href="#" data-tool="qr-generator"><i class="fas fa-qrcode"></i> <span>QR Code Generator</span></a></li>
                            <li><a href="#" data-tool="password-generator"><i class="fas fa-key"></i> <span>Password Generator</span></a></li>
                            <li><a href="#" data-tool="age-calculator"><i class="fas fa-birthday-cake"></i> <span>Age Calculator</span></a></li>
                            <li><a href="#" data-tool="emi-calculator"><i class="fas fa-rupee-sign"></i> <span>EMI Calculator</span></a></li>
                            <li><a href="#" data-tool="color-picker"><i class="fas fa-palette"></i> <span>Color Picker</span></a></li>
                            <li><a href="#" data-tool="unit-converter"><i class="fas fa-balance-scale"></i> <span>Unit Converter</span></a></li>
                            <li><a href="#" data-tool="timer-stopwatch"><i class="fas fa-stopwatch"></i> <span>Timer / Stopwatch</span></a></li>
                        </ul>
                    </li>
                </ul>
            </aside>

            <!-- 3. Main Content Area -->
            <main class="main-content" id="home">
                <section class="hero-section">
                    <h2 class="glow-text">Unlock Your Digital Potential</h2>
                    <p>Your all-in-one hub for powerful PDF, Image, Text, and Utility tools. Streamline your workflow with Divya Center.</p>
                    <button class="cta-button" onclick="document.getElementById('tools').scrollIntoView({behavior: 'smooth'});">Explore Tools <i class="fas fa-arrow-right"></i></button>
                </section>

                <section class="tools-grid-section" id="tools">
                    <h3>Featured Tools</h3>
                    <div class="tools-grid">
                        <div class="tool-card" data-tool="merge-pdf">
                            <i class="fas fa-object-group tool-icon"></i>
                            <h4>Merge PDF</h4>
                            <p>Combine multiple PDF files into one single document easily.</p>
                            <button class="open-tool-btn">Open Tool</button>
                        </div>
                        <div class="tool-card" data-tool="image-compressor">
                            <i class="fas fa-compress tool-icon"></i>
                            <h4>Image Compressor</h4>
                            <p>Reduce image file sizes without significant quality loss.</p>
                            <button class="open-tool-btn">Open Tool</button>
                        </div>
                        <div class="tool-card" data-tool="json-formatter">
                            <i class="fas fa-code tool-icon"></i>
                            <h4>JSON Formatter</h4>
                            <p>Format or minify JSON data for readability or size.</p>
                            <button class="open-tool-btn">Open Tool</button>
                        </div>
                        <div class="tool-card" data-tool="speech-to-text">
                            <i class="fas fa-microphone-alt tool-icon"></i>
                            <h4>Speech to Text</h4>
                            <p>Convert your spoken words into written text.</p>
                            <button class="open-tool-btn">Open Tool</button>
                        </div>
                        <div class="tool-card" data-tool="password-generator">
                            <i class="fas fa-key tool-icon"></i>
                            <h4>Password Generator</h4>
                            <p>Generate strong, secure, and random passwords.</p>
                            <button class="open-tool-btn">Open Tool</button>
                        </div>
                         <div class="tool-card" data-tool="emi-calculator">
                            <i class="fas fa-rupee-sign tool-icon"></i>
                            <h4>EMI Calculator</h4>
                            <p>Calculate your Equated Monthly Installments for loans.</p>
                            <button class="open-tool-btn">Open Tool</button>
                        </div>
                        <div class="tool-card" data-tool="timer-stopwatch">
                            <i class="fas fa-stopwatch tool-icon"></i>
                            <h4>Timer / Stopwatch</h4>
                            <p>Precise timing for your tasks and activities.</p>
                            <button class="open-tool-btn">Open Tool</button>
                        </div>
                        <div class="tool-card" data-tool="age-calculator">
                            <i class="fas fa-birthday-cake tool-icon"></i>
                            <h4>Age Calculator</h4>
                            <p>Calculate age from date of birth accurately.</p>
                            <button class="open-tool-btn">Open Tool</button>
                        </div>
                        <div class="tool-card" data-tool="unit-converter">
                             <i class="fas fa-balance-scale tool-icon"></i>
                            <h4>Unit Converter</h4>
                            <p>Convert various units like length, weight, temperature.</p>
                            <button class="open-tool-btn">Open Tool</button>
                        </div>
                         <div class="tool-card" data-tool="color-picker">
                             <i class="fas fa-palette tool-icon"></i>
                            <h4>Color Picker</h4>
                            <p>Select and identify colors with HEX, RGB, HSL values.</p>
                            <button class="open-tool-btn">Open Tool</button>
                        </div>
                    </div>
                </section>

                <section id="about" class="content-section">
                    <h3>About Divya Center</h3>
                    <p>Divya Center is dedicated to providing simple, effective, and free online tools to help individuals and businesses manage their digital tasks efficiently. Our futuristic interface aims to make your experience enjoyable and productive.</p>
                     <p>We believe in the power of accessible technology and strive to offer a comprehensive suite of tools that are both powerful and easy to use. All tools are designed to work directly in your browser, ensuring your data privacy and security.</p>
                </section>

                <section id="contact" class="content-section">
                    <h3>Contact Us</h3>
                    <p>Have questions, feedback, or suggestions for new tools? We'd love to hear from you!</p>
                    <p>Reach out to us at <a href="mailto:contact@divyacenter.example.com" class="glow-text-hover">contact@divyacenter.example.com</a>.</p>
                </section>
            </main>
        </div>

        <footer class="footer">
            <div class="footer-content">
                <p>© <span id="currentYear"></span> Divya Center. All Rights Reserved.</p>
                <div class="footer-links">
                    <a href="#privacy">Privacy Policy</a> |
                    <a href="#terms">Terms of Service</a> |
                    <a href="#contact" onclick="document.getElementById('contact').scrollIntoView({behavior: 'smooth'}); return false;">Contact</a>
                </div>
                <div class="social-icons">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
        </footer>
    </div>

    <div id="toolModal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn" aria-label="Close modal">×</button>
            <h3 id="modalToolTitle">Tool Title</h3>
            <div id="modalToolContent"></div>
            <div id="modalToolStatus" class="tool-status"></div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        console.log("DOM fully loaded and parsed. Initializing script...");

        const hamburgerMenu = document.querySelector('.hamburger-menu');
        const navLinksContainer = document.querySelector('.navbar .nav-links');
        const mainNavLinks = document.querySelectorAll('.navbar .nav-links a');

        let currentToolCleanupFunction = null; // For tool-specific cleanup, e.g., stopping speech recognition

        if (hamburgerMenu && navLinksContainer) {
            hamburgerMenu.addEventListener('click', () => {
                navLinksContainer.classList.toggle('active');
                hamburgerMenu.querySelector('i').classList.toggle('fa-bars');
                hamburgerMenu.querySelector('i').classList.toggle('fa-times');
            });
        } else {
            console.warn("Hamburger menu or nav links container not found.");
        }

        mainNavLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                mainNavLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                if (navLinksContainer.classList.contains('active')) {
                    navLinksContainer.classList.remove('active');
                    hamburgerMenu.querySelector('i').classList.remove('fa-times');
                    hamburgerMenu.querySelector('i').classList.add('fa-bars');
                }
                const targetId = this.getAttribute('href');
                if (targetId && targetId.startsWith('#')) {
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        e.preventDefault();
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                    }
                }
            });
        });
        
        function onScroll() {
            let currentSectionId = "home"; // Default to home
            const sections = document.querySelectorAll('main > section[id]');
            const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
            const navBarHeight = document.querySelector('.navbar')?.offsetHeight || 60;

            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.offsetHeight;
                if (scrollPosition >= sectionTop - navBarHeight && 
                    scrollPosition < sectionTop + sectionHeight - navBarHeight) {
                    currentSectionId = section.getAttribute('id');
                }
            });
            
            mainNavLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${currentSectionId}`) {
                    link.classList.add('active');
                }
            });
        }
        window.addEventListener('scroll', onScroll);
        onScroll(); 

        const sidebar = document.querySelector('.sidebar');
        const sidebarToggleBtn = document.querySelector('.sidebar-toggle-btn');
        const categoryToggles = document.querySelectorAll('.category-toggle');

        if (sidebarToggleBtn && sidebar) {
             if (window.innerWidth > 768) { 
                sidebarToggleBtn.addEventListener('click', () => {
                    sidebar.classList.toggle('collapsed');
                    localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
                });
                if (localStorage.getItem('sidebarCollapsed') === 'true') {
                    sidebar.classList.add('collapsed');
                }
             } else { 
                sidebar.classList.remove('collapsed');
                sidebarToggleBtn.style.display = 'none';
             }
        } else {
            console.warn("Sidebar or sidebar toggle button not found.");
        }

        categoryToggles.forEach(toggle => {
            toggle.addEventListener('click', () => {
                if (sidebar.classList.contains('collapsed') && window.innerWidth > 768) return;
                toggle.classList.toggle('active');
                const toolList = toggle.nextElementSibling;
                if (toolList && toolList.classList.contains('tool-list')) {
                    if (toolList.classList.contains('open')) {
                        toolList.style.maxHeight = null;
                        toolList.classList.remove('open');
                    } else {
                        toolList.classList.add('open');
                        toolList.style.maxHeight = toolList.scrollHeight + "px";
                    }
                }
            });
        });

        const currentYearSpan = document.getElementById('currentYear');
        if (currentYearSpan) {
            currentYearSpan.textContent = new Date().getFullYear();
        }

        const modal = document.getElementById('toolModal');
        const modalCloseBtn = document.querySelector('.modal-close-btn');
        const modalToolTitle = document.getElementById('modalToolTitle');
        const modalToolContent = document.getElementById('modalToolContent');
        const modalToolStatus = document.getElementById('modalToolStatus');
        const openToolButtons = document.querySelectorAll('.open-tool-btn, .sidebar .tool-list a');

        if (!modal || !modalCloseBtn || !modalToolTitle || !modalToolContent || !modalToolStatus) {
            console.error("Critical Modal elements are missing from the DOM!");
            return; 
        }

        let currentToolIntervals = []; 
        function clearCurrentToolIntervals() {
            currentToolIntervals.forEach(clearInterval);
            currentToolIntervals = [];
        }

        function openModal(toolId, toolName) {
            console.log(`Attempting to open modal for tool: ${toolId}, name: ${toolName}`);
            
            if (currentToolCleanupFunction) { // Cleanup previous tool if any special cleanup was registered
                console.log("[Modal] Calling cleanup for previous tool.");
                currentToolCleanupFunction();
                currentToolCleanupFunction = null;
            }
            clearCurrentToolIntervals(); // Clear any active setIntervals from previous tool

            modalToolTitle.textContent = toolName || "Tool";
            modalToolContent.innerHTML = '<p style="text-align:center; padding:2rem 0;">Loading tool...</p>';
            modalToolStatus.style.display = 'none';
            modalToolStatus.className = 'tool-status';

            setTimeout(() => { // Ensure modal structure is in DOM before loading tool UI
                try {
                    loadToolUI(toolId, toolName); // This might set a new currentToolCleanupFunction
                } catch (error) {
                    console.error(`Error loading UI for ${toolId}:`, error);
                    modalToolContent.innerHTML = `<p style="color:red; text-align:center;">Error loading tool UI. Check console.</p>`;
                }
            }, 50); 

            modal.classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            if (currentToolCleanupFunction) { // Cleanup current tool if a cleanup function is registered
                console.log("[Modal] Calling cleanup for current tool before closing.");
                currentToolCleanupFunction();
                currentToolCleanupFunction = null;
            }
            clearCurrentToolIntervals(); // Clear any active setIntervals

            modal.classList.remove('open');
            document.body.style.overflow = '';
            modalToolContent.innerHTML = ''; 
            modalToolStatus.style.display = 'none'; // Hide status on close
            modalToolStatus.className = 'tool-status'; // Reset status class
        }

        modalCloseBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (event) => {
            if (event.target === modal) closeModal();
        });
        document.addEventListener('keydown', (event) => {
            if (event.key === "Escape" && modal.classList.contains('open')) closeModal();
        });

        if (openToolButtons.length > 0) {
            openToolButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    const toolElement = button.closest('[data-tool]') || button;
                    const toolId = toolElement.dataset.tool;
                    let toolName = "Tool";
                    if(toolElement.querySelector('h4')) toolName = toolElement.querySelector('h4').textContent;
                    else if (toolElement.querySelector('span')) toolName = toolElement.querySelector('span').textContent;
                    else toolName = toolElement.textContent.trim() || toolId.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    
                    if (toolId) {
                        openModal(toolId, toolName);
                    } else {
                        console.warn("Tool ID not found for button:", button);
                    }
                });
            });
        } else {
            console.warn("No 'open tool' buttons found.");
        }
        

        function showStatus(message, type = 'processing', duration = 0) {
            modalToolStatus.textContent = message;
            modalToolStatus.className = 'tool-status ' + type;
            modalToolStatus.style.display = 'block';
            if (duration > 0) {
                setTimeout(() => {
                    // Only hide if the message is still the same, to avoid hiding a newer status message
                    if (modalToolStatus.textContent === message && modalToolStatus.classList.contains(type)) { 
                       modalToolStatus.style.display = 'none';
                    }
                } , duration);
            }
        }

        function simulateProcessing(currentToolName, onComplete, filesCount = 1) {
            showStatus(`Uploading ${filesCount} file(s)...`, 'processing');
            setTimeout(() => {
                showStatus('Processing...', 'processing');
                setTimeout(() => {
                    showStatus(`${currentToolName} completed! Your download should start.`, 'success', 5000);
                    if (onComplete) onComplete();
                }, 1200 + Math.random() * 800);
            }, 800 + Math.random() * 400);
        }
        
        function downloadFile(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showStatus(`Downloaded: ${filename}`, 'success', 4000);
        }

        const createFileUploadUI = (acceptedFileTypes = "*/*", multiple = false, toolIdSuffix = "default") => {
            return `
                <div class="file-drop-area">
                    <input type="file" id="fileInput-${toolIdSuffix}" accept="${acceptedFileTypes}" ${multiple ? 'multiple' : ''} style="display:none;">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: var(--accent-cyan); margin-bottom: 1rem;"></i>
                    <p>Drag & drop file(s) here, or <label for="fileInput-${toolIdSuffix}" class="glow-text-hover" style="cursor:pointer; text-decoration:underline;">click to browse</label>.</p>
                    ${acceptedFileTypes !== "*/*" ? `<small>Accepted types: ${acceptedFileTypes.split(',').map(t => t.trim().toUpperCase()).join(', ')}</small>` : ''}
                </div>
                <div class="file-preview" id="filePreview-${toolIdSuffix}"></div>
                <button id="processBtn-${toolIdSuffix}" class="cta-button" style="margin-top: 1rem; display:none; width:100%;">Process File(s)</button>
            `;
        };
        
        const setupFileHandling = (toolIdPrefix) => {
            console.log(`Setting up file handling for tool prefix: ${toolIdPrefix}`);
            const fileInput = document.getElementById(`fileInput-${toolIdPrefix}`);
            const dropArea = fileInput ? fileInput.closest('.file-drop-area') : null; 
            const previewArea = document.getElementById(`filePreview-${toolIdPrefix}`);
            const processBtn = document.getElementById(`processBtn-${toolIdPrefix}`);
            let filesToProcess = [];

            if (!fileInput || !dropArea || !previewArea || !processBtn) {
                console.error("File handling UI elements not found for", toolIdPrefix, 
                              {fileInputPresent: !!fileInput, dropAreaPresent: !!dropArea, previewAreaPresent: !!previewArea, processBtnPresent: !!processBtn});
                if(modalToolContent.firstChild?.textContent?.includes("Loading tool...")) { 
                    modalToolContent.innerHTML = `<p style="color:red; text-align:center;">Error initializing file upload for this tool. Essential elements missing.</p>`;
                }
                return { getFiles: () => [], processBtn: null, clearFiles: () => {} }; // Return a "safe" object
            }
            console.log("File handling elements found for", toolIdPrefix);


            function displayFiles(newFiles) {
                filesToProcess = Array.from(newFiles);
                previewArea.innerHTML = ''; 
                if (filesToProcess.length === 0) {
                    processBtn.style.display = 'none';
                    return;
                }
                filesToProcess.forEach(file => {
                    const fileElement = document.createElement('div');
                    let previewContent = `<span>${file.name} (${(file.size / 1024).toFixed(2)} KB)</span>`;
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const imgPreview = document.createElement('img');
                            imgPreview.src = e.target.result;
                            imgPreview.alt = file.name;
                            fileElement.prepend(imgPreview);
                        }
                        reader.readAsDataURL(file);
                    } else if (file.type.startsWith('audio/')) {
                         const audioPreview = document.createElement('audio');
                         audioPreview.src = URL.createObjectURL(file);
                         audioPreview.controls = true;
                         fileElement.appendChild(audioPreview); 
                    } else if (file.type.startsWith('video/')) {
                         const videoPreview = document.createElement('video');
                         videoPreview.src = URL.createObjectURL(file);
                         videoPreview.controls = true;
                         videoPreview.style.maxWidth = '200px'; 
                         fileElement.appendChild(videoPreview);
                    }
                    const textNode = document.createElement('span'); 
                    textNode.innerHTML = previewContent;
                    fileElement.prepend(textNode); // Prepend so it appears before media controls
                    
                    previewArea.appendChild(fileElement);
                });
                processBtn.style.display = 'block';
            }
            
            function clearFiles() {
                filesToProcess.forEach(file => { // Revoke object URLs for media files to free resources
                    if (file.type.startsWith('audio/') || file.type.startsWith('video/')) {
                        const mediaElements = previewArea.querySelectorAll(`audio[src^="blob:"], video[src^="blob:"]`);
                        mediaElements.forEach(el => URL.revokeObjectURL(el.src));
                    }
                });
                filesToProcess = [];
                if(previewArea) previewArea.innerHTML = '';
                if(processBtn) processBtn.style.display = 'none';
                if(fileInput) fileInput.value = ''; // Reset file input
            }

            dropArea.addEventListener('dragover', (e) => { e.preventDefault(); dropArea.classList.add('dragover'); });
            dropArea.addEventListener('dragleave', () => dropArea.classList.remove('dragover'));
            dropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dropArea.classList.remove('dragover');
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    displayFiles(e.dataTransfer.files);
                }
            });
            fileInput.addEventListener('change', (e) => displayFiles(e.target.files));
            return { getFiles: () => filesToProcess, processBtn, clearFiles };
        };

        function setupPdfToolSimulation(currentToolId, currentToolName, acceptedFileTypes, allowMultiple) {
            modalToolContent.innerHTML = createFileUploadUI(acceptedFileTypes, allowMultiple, currentToolId);
            const handler = setupFileHandling(currentToolId);
            if (handler.processBtn) {
                handler.processBtn.textContent = `Start ${currentToolName}`;
                handler.processBtn.onclick = () => {
                    const files = handler.getFiles();
                    if (files.length === 0) {
                        showStatus('Please select file(s) first.', 'error', 3000);
                        return;
                    }
                    simulateProcessing(currentToolName, () => {
                        const firstFileName = files[0].name.split('.')[0] || 'file';
                        let outputExtension = 'zip'; // Default for multiple or unknown
                        if (!allowMultiple && currentToolId.includes('-to-')) {
                            const parts = currentToolId.split('-to-');
                            if (parts.length > 1 && !parts[1].includes('pdf')) { // e.g. pdf-to-word
                                outputExtension = parts[1];
                                if(outputExtension === 'ppt') outputExtension = 'pptx';
                                if(outputExtension === 'excel') outputExtension = 'xlsx';
                                if(outputExtension === 'word') outputExtension = 'docx';
                            } else { // e.g., word-to-pdf
                                 outputExtension = 'pdf'; 
                            }
                        } else if (!allowMultiple && currentToolId.endsWith('pdf')) { // e.g. compress-pdf, word-to-pdf, jpg-to-pdf
                            outputExtension = 'pdf';
                        } else if (currentToolId === 'merge-pdf') {
                            outputExtension = 'pdf';
                        }
                        
                        const fakeBlob = new Blob([`Simulated output for ${currentToolName}`], { type: 'application/octet-stream' });
                        downloadFile(fakeBlob, `processed_${currentToolId}_${firstFileName}.${outputExtension}`);
                        handler.clearFiles();
                    }, files.length);
                };
            }
        }

        // --- START: COLOR CONVERSION HELPER FUNCTIONS ---
        function hexToRgb(hex) {
            let r = 0, g = 0, b = 0;
            hex = String(hex).replace(/[^0-9a-f]/gi, '');
            if (hex.length < 3) return null; // Invalid hex

            if (hex.length === 3) { // #RGB
                r = parseInt(hex[0] + hex[0], 16);
                g = parseInt(hex[1] + hex[1], 16);
                b = parseInt(hex[2] + hex[2], 16);
            } else if (hex.length === 6) { // #RRGGBB
                r = parseInt(hex.substring(0, 2), 16);
                g = parseInt(hex.substring(2, 4), 16);
                b = parseInt(hex.substring(4, 6), 16);
            } else { // Handle cases like #F00 which might come as #F00 from input type color
                 if(hex.startsWith('#')) hex = hex.substring(1); // remove # if present
                 if (hex.length == 3) {
                    r = parseInt(hex[0] + hex[0], 16);
                    g = parseInt(hex[1] + hex[1], 16);
                    b = parseInt(hex[2] + hex[2], 16);
                 } else if (hex.length == 6) {
                    r = parseInt(hex.substring(0, 2), 16);
                    g = parseInt(hex.substring(2, 4), 16);
                    b = parseInt(hex.substring(4, 6), 16);
                 } else {
                    return null;
                 }
            }
            return (isNaN(r) || isNaN(g) || isNaN(b)) ? null : { r, g, b };
        }


        function rgbToHsl(r, g, b) {
            r /= 255; g /= 255; b /= 255;
            const max = Math.max(r, g, b), min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;

            if (max === min) {
                h = s = 0; // achromatic
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
            return {
                h: Math.round(h * 360),
                s: Math.round(s * 100),
                l: Math.round(l * 100)
            };
        }
        // --- END: COLOR CONVERSION HELPER FUNCTIONS ---

        // --- UNIT CONVERTER HELPER FUNCTION ---
        function createOption(value, text) { // Moved here to be accessible by unit converter
            const option = document.createElement('option');
            option.value = value;
            option.textContent = text;
            return option;
        }

        function loadToolUI(toolId, toolName) {
            console.log(`Executing loadToolUI for: ${toolId} (${toolName})`);
            modalToolContent.innerHTML = ''; // Clear previous content FIRST
            currentToolCleanupFunction = null; // Reset cleanup function for the new tool

            switch (toolId) {
                // PDF Input Tools
                case 'merge-pdf':       setupPdfToolSimulation(toolId, toolName, '.pdf,application/pdf', true); break;
                case 'split-pdf':       setupPdfToolSimulation(toolId, toolName, '.pdf,application/pdf', false); break;
                case 'compress-pdf':    setupPdfToolSimulation(toolId, toolName, '.pdf,application/pdf', false); break;
                case 'pdf-to-word':     setupPdfToolSimulation(toolId, toolName, '.pdf,application/pdf', false); break;
                case 'pdf-to-ppt':      setupPdfToolSimulation(toolId, toolName, '.pdf,application/pdf', false); break;
                case 'pdf-to-excel':    setupPdfToolSimulation(toolId, toolName, '.pdf,application/pdf', false); break;
                case 'pdf-to-jpg':      setupPdfToolSimulation(toolId, toolName, '.pdf,application/pdf', false); break;
                case 'organize-pdf':    setupPdfToolSimulation(toolId, toolName, '.pdf,application/pdf', true); break;
                case 'edit-pdf':        setupPdfToolSimulation(toolId, toolName, '.pdf,application/pdf', false); break;
                case 'rotate-pdf':      setupPdfToolSimulation(toolId, toolName, '.pdf,application/pdf', false); break;
                case 'unlock-pdf':      setupPdfToolSimulation(toolId, toolName, '.pdf,application/pdf', false); break;
                case 'protect-pdf':     setupPdfToolSimulation(toolId, toolName, '.pdf,application/pdf', false); break;
                case 'add-page-numbers':setupPdfToolSimulation(toolId, toolName, '.pdf,application/pdf', false); break;
                case 'add-watermark':   setupPdfToolSimulation(toolId, toolName, '.pdf,application/pdf', false); break;

                // Other Input to PDF Tools
                case 'word-to-pdf':     setupPdfToolSimulation(toolId, toolName, '.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document', false); break;
                case 'ppt-to-pdf':      setupPdfToolSimulation(toolId, toolName, '.ppt,.pptx,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation', false); break;
                case 'excel-to-pdf':    setupPdfToolSimulation(toolId, toolName, '.xls,.xlsx,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', false); break;
                case 'jpg-to-pdf':      setupPdfToolSimulation(toolId, toolName, 'image/jpeg,image/jpg,image/png', true); break;

                case 'image-compressor':
                    modalToolContent.innerHTML = createFileUploadUI('image/*', false, toolId) + 
                        `<div class="tool-input-group" style="margin-top:1rem;">
                            <label for="imgQuality-${toolId}">Quality (0.1 - 1.0): </label>
                            <input type="number" id="imgQuality-${toolId}" value="0.7" min="0.1" max="1" step="0.1">
                        </div>`;
                    const imgCompressor = setupFileHandling(toolId); 
                    if (imgCompressor.processBtn) {
                        const qualityInput = document.getElementById(`imgQuality-${toolId}`); 
                        imgCompressor.processBtn.textContent = "Compress Image";
                        imgCompressor.processBtn.onclick = () => {
                            const files = imgCompressor.getFiles();
                            if (files.length === 0) { showStatus('Please select an image.', 'error', 3000); return; }
                            const file = files[0];
                            const quality = parseFloat(qualityInput.value) || 0.7;
                            showStatus('Compressing...', 'processing');
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const img = new Image();
                                img.onload = () => {
                                    const canvas = document.createElement('canvas');
                                    canvas.width = img.width; canvas.height = img.height;
                                    const ctx = canvas.getContext('2d');
                                    ctx.drawImage(img, 0, 0, img.width, img.height);
                                    canvas.toBlob((blob) => {
                                        if (blob) downloadFile(blob, `compressed_${file.name}`);
                                        else showStatus('Error creating blob.', 'error', 3000);
                                        imgCompressor.clearFiles();
                                    }, file.type.startsWith('image/png') ? 'image/png' : 'image/jpeg', quality);
                                }
                                img.onerror = () => { showStatus('Could not load image.', 'error', 3000); imgCompressor.clearFiles(); }
                                img.src = e.target.result;
                            }
                            reader.readAsDataURL(file);
                        };
                    }
                    break;
                
                case 'image-converter':
                    modalToolContent.innerHTML = createFileUploadUI('image/jpeg,image/png,image/webp,image/gif,image/bmp', false, toolId) +
                        `<div class="tool-input-group" style="margin-top:1rem;">
                            <label for="convertTo-${toolId}">Convert to: </label>
                            <select id="convertTo-${toolId}">
                                <option value="image/jpeg">JPEG</option>
                                <option value="image/png">PNG</option>
                                <option value="image/webp">WEBP</option>
                                <option value="image/gif">GIF</option>
                                <option value="image/bmp">BMP</option>
                            </select>
                        </div>`;
                    const imgConverter = setupFileHandling(toolId);
                    if (imgConverter.processBtn) {
                        const convertToSelect = document.getElementById(`convertTo-${toolId}`);
                        imgConverter.processBtn.textContent = "Convert Image";
                        imgConverter.processBtn.onclick = () => {
                            const files = imgConverter.getFiles();
                            if (files.length === 0) { showStatus('Please select an image.', 'error', 3000); return; }
                            const file = files[0];
                            const targetType = convertToSelect.value;
                            const targetExt = targetType.split('/')[1];
                            showStatus('Converting...', 'processing');
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const img = new Image();
                                img.onload = () => {
                                    const canvas = document.createElement('canvas');
                                    canvas.width = img.width; canvas.height = img.height;
                                    const ctx = canvas.getContext('2d');
                                    if (targetType === 'image/jpeg' && (file.type === 'image/png' || file.type === 'image/gif')) { // Add white background for formats that support transparency
                                        ctx.fillStyle = "#FFFFFF"; ctx.fillRect(0,0,canvas.width, canvas.height);
                                    }
                                    ctx.drawImage(img, 0, 0);
                                    canvas.toBlob((blob) => {
                                        if (blob) downloadFile(blob, `${file.name.split('.')[0]}_converted.${targetExt}`);
                                        else showStatus('Error converting image.', 'error', 3000);
                                        imgConverter.clearFiles();
                                    }, targetType, 0.9); // Quality 0.9 for JPEG/WEBP, ignored for PNG/GIF/BMP
                                };
                                img.onerror = () => { showStatus('Could not load image.', 'error', 3000); imgConverter.clearFiles(); }
                                img.src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        };
                    }
                    break;

                case 'qr-generator':
                    modalToolContent.innerHTML = `
                        <div class="tool-input-group">
                            <label for="qrText-${toolId}">Text or URL for QR Code:</label>
                            <textarea id="qrText-${toolId}" rows="4" placeholder="Enter data here..."></textarea>
                        </div>
                        <button id="generateQrBtn-${toolId}" class="tool-ui-button" style="width:100%;">Generate QR Code</button>
                        <div id="qrCodeOutput-${toolId}" style="margin-top:1.5rem; text-align:center; min-height:200px; display:flex; justify-content:center; align-items:center; border: 1px dashed var(--accent-cyan); border-radius:4px; padding:1rem;">
                            <small>QR Code will appear here</small>
                        </div>`;
                    const qrText = document.getElementById(`qrText-${toolId}`);
                    const generateQrBtn = document.getElementById(`generateQrBtn-${toolId}`);
                    const qrCodeOutput = document.getElementById(`qrCodeOutput-${toolId}`);
                    generateQrBtn.onclick = () => {
                        const text = qrText.value.trim();
                        if (!text) { showStatus('Please enter text for QR code.', 'error', 3000); return; }
                        showStatus('Generating QR...', 'processing');
                        qrCodeOutput.innerHTML = '<i class="fas fa-spinner fa-spin" style="font-size:2rem; color:var(--accent-cyan);"></i>';
                        const qrImg = new Image();
                        qrImg.onload = () => {
                            qrCodeOutput.innerHTML = ''; qrCodeOutput.appendChild(qrImg);
                            showStatus('QR Code Generated!', 'success', 3000);
                        }
                        qrImg.onerror = () => {
                            qrCodeOutput.innerHTML = '<small>Error generating QR. Try again.</small>';
                            showStatus('Failed to generate QR.', 'error', 4000);
                        }
                        // Using a reliable QR code API
                        qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(text)}&format=svg&color=42f8f5&bgcolor=0d0f14&qzone=1`;
                        qrImg.style.maxWidth = "200px"; qrImg.style.maxHeight = "200px";
                        qrImg.style.border = "2px solid var(--accent-cyan)";
                        qrImg.style.padding = "5px";
                        qrImg.style.backgroundColor = "var(--main-bg-color)";
                    };
                    break;

                case 'password-generator':
                    modalToolContent.innerHTML = `
                        <div class="tool-input-group">
                            <label for="pgLength-${toolId}" style="display:block; margin-bottom:0.25rem;">Length: <span id="lengthValue-${toolId}">16</span></label>
                            <input type="range" id="pgLength-${toolId}" min="8" max="64" value="16" style="width:100%;">
                        </div>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:0.5rem; margin-bottom:1rem;">
                            <div><input type="checkbox" id="pgUppercase-${toolId}" checked> <label for="pgUppercase-${toolId}">ABC</label></div>
                            <div><input type="checkbox" id="pgLowercase-${toolId}" checked> <label for="pgLowercase-${toolId}">abc</label></div>
                            <div><input type="checkbox" id="pgNumbers-${toolId}" checked> <label for="pgNumbers-${toolId}">123</label></div>
                            <div><input type="checkbox" id="pgSymbols-${toolId}" checked> <label for="pgSymbols-${toolId}">!@#</label></div>
                        </div>
                        <input type="text" id="generatedPassword-${toolId}" readonly placeholder="Your secure password..." style="width:100%; padding:0.75rem; margin-bottom:1rem; background:var(--main-bg-color); color:var(--accent-cyan); border:1px solid var(--accent-cyan); text-align:center; font-weight:bold; font-size:1.1rem;">
                        <button id="generatePassBtn-${toolId}" class="tool-ui-button" style="width:100%; margin-bottom:0.5rem;">Generate Password</button>
                        <button id="copyPassBtn-${toolId}" class="tool-ui-button" style="width:100%; background:var(--sidebar-bg); display:none;">Copy Password</button>`;
                    const pgLength = document.getElementById(`pgLength-${toolId}`);
                    const lengthValue = document.getElementById(`lengthValue-${toolId}`);
                    const pgUppercase = document.getElementById(`pgUppercase-${toolId}`);
                    const pgLowercase = document.getElementById(`pgLowercase-${toolId}`);
                    const pgNumbers = document.getElementById(`pgNumbers-${toolId}`);
                    const pgSymbols = document.getElementById(`pgSymbols-${toolId}`);
                    const generatePassBtn = document.getElementById(`generatePassBtn-${toolId}`);
                    const generatedPasswordInput = document.getElementById(`generatedPassword-${toolId}`);
                    const copyPassBtn = document.getElementById(`copyPassBtn-${toolId}`);

                    pgLength.oninput = () => lengthValue.textContent = pgLength.value;
                    const generatePassword = () => {
                        const length = parseInt(pgLength.value);
                        const chars = { upper: "ABCDEFGHIJKLMNOPQRSTUVWXYZ", lower: "abcdefghijklmnopqrstuvwxyz", nums: "0123456789", syms: "!@#$%^&*()_+-=[]{}|;:,.<>?" };
                        let charset = "", guaranteedChars = "";
                        if (pgUppercase.checked) { charset += chars.upper; if (chars.upper.length > 0) guaranteedChars += chars.upper[Math.floor(Math.random() * chars.upper.length)]; }
                        if (pgLowercase.checked) { charset += chars.lower; if (chars.lower.length > 0) guaranteedChars += chars.lower[Math.floor(Math.random() * chars.lower.length)]; }
                        if (pgNumbers.checked) { charset += chars.nums; if (chars.nums.length > 0) guaranteedChars += chars.nums[Math.floor(Math.random() * chars.nums.length)]; }
                        if (pgSymbols.checked) { charset += chars.syms; if (chars.syms.length > 0) guaranteedChars += chars.syms[Math.floor(Math.random() * chars.syms.length)]; }
                        if (charset === "") { showStatus("Select at least one character set.", 'error', 3000); generatedPasswordInput.value = ""; copyPassBtn.style.display = 'none'; return; }
                        
                        let password = guaranteedChars;
                        for (let i = guaranteedChars.length; i < length; i++) password += charset.charAt(Math.floor(Math.random() * charset.length));
                        
                        // Shuffle the password to ensure guaranteed characters are not always at the start
                        password = password.split('').sort(() => 0.5 - Math.random()).join(''); 
                        
                        generatedPasswordInput.value = password; copyPassBtn.style.display = 'block'; showStatus("Password Generated!", 'success', 2000);
                    };
                    generatePassBtn.onclick = generatePassword;
                    copyPassBtn.onclick = () => {
                        if(generatedPasswordInput.value) navigator.clipboard.writeText(generatedPasswordInput.value)
                            .then(() => showStatus('Password copied!', 'success', 2000))
                            .catch(err => showStatus('Failed to copy.', 'error', 2000));
                    };
                    generatePassword(); // Generate one on load
                    break;
                
                case 'text-to-speech':
                    modalToolContent.innerHTML = `
                        <div class="tool-input-group">
                            <label for="ttsText-${toolId}">Text to Speak:</label>
                            <textarea id="ttsText-${toolId}" rows="5" placeholder="Enter text here..."></textarea>
                        </div>
                        <div class="tool-input-group" style="display:flex; gap:1rem; flex-wrap:wrap;">
                            <select id="ttsVoice-${toolId}" style="flex-grow:1; min-width:200px;"></select>
                            <button id="speakBtn-${toolId}" class="tool-ui-button" style="padding: 0.5rem 1rem;">Speak</button>
                            <button id="stopBtn-${toolId}" class="tool-ui-button" style="padding: 0.5rem 1rem; background:var(--sidebar-bg);">Stop</button>
                        </div>`;
                    if (typeof speechSynthesis === 'undefined') {
                        modalToolContent.innerHTML = "<p>Sorry, your browser does not support Text-to-Speech.</p>"; break;
                    }
                    const ttsText = document.getElementById(`ttsText-${toolId}`);
                    const ttsVoiceSelect = document.getElementById(`ttsVoice-${toolId}`);
                    const speakBtn = document.getElementById(`speakBtn-${toolId}`);
                    const stopBtn = document.getElementById(`stopBtn-${toolId}`);
                    let voices = [];
                    function populateVoiceList() {
                        voices = speechSynthesis.getVoices();
                        ttsVoiceSelect.innerHTML = '';
                        const preferredLang = navigator.language.split('-')[0];
                        voices.sort((a,b) => {
                            if (a.lang.startsWith(preferredLang) && !b.lang.startsWith(preferredLang)) return -1;
                            if (!a.lang.startsWith(preferredLang) && b.lang.startsWith(preferredLang)) return 1;
                            return 0;
                        });
                        voices.forEach((voice) => {
                            const option = document.createElement('option');
                            option.textContent = `${voice.name} (${voice.lang}) ${voice.default ? '[Default]' : ''}`;
                            option.setAttribute('data-lang', voice.lang); option.setAttribute('data-name', voice.name);
                            if(voice.default) option.selected = true;
                            ttsVoiceSelect.appendChild(option);
                        });
                        if (voices.length === 0) showStatus("No speech voices available in this browser.", "error");
                    }
                    populateVoiceList();
                    if (speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = populateVoiceList;
                    
                    let currentUtterance = null;
                    speakBtn.onclick = () => {
                        const text = ttsText.value.trim();
                        if (!text) { showStatus('Please enter text to speak.', 'error', 3000); return; }
                        if (speechSynthesis.speaking) speechSynthesis.cancel(); // Stop any previous speech
                        
                        currentUtterance = new SpeechSynthesisUtterance(text);
                        if (ttsVoiceSelect.selectedOptions.length > 0) { 
                            const selectedVoiceName = ttsVoiceSelect.selectedOptions[0].getAttribute('data-name');
                            currentUtterance.voice = voices.find(voice => voice.name === selectedVoiceName);
                        } else if (voices.length > 0) { // Fallback if no voice selected (shouldn't happen with default)
                            currentUtterance.voice = voices[0];
                        }
                        currentUtterance.onstart = () => showStatus('Speaking...', 'processing');
                        currentUtterance.onend = () => {
                            showStatus('Finished speaking.', 'success', 3000);
                            currentUtterance = null; // Clear utterance after it ends
                        }
                        currentUtterance.onerror = (e) => {
                            showStatus(`Speech error: ${e.error}`, 'error', 4000);
                            currentUtterance = null;
                        }
                        speechSynthesis.speak(currentUtterance);
                    };
                    stopBtn.onclick = () => {
                        if (speechSynthesis.speaking) { 
                            speechSynthesis.cancel(); 
                            showStatus('Speech stopped.', 'success', 2000);
                        }
                        currentUtterance = null; // Also clear if stopped manually
                    };
                    currentToolCleanupFunction = () => { // Cleanup for Text-to-Speech
                        if (speechSynthesis && speechSynthesis.speaking) {
                            speechSynthesis.cancel();
                        }
                        currentUtterance = null;
                    };
                    break;
                
                case 'word-counter':
                    modalToolContent.innerHTML = `
                        <div class="tool-input-group">
                            <label for="wcText-${toolId}">Your Text:</label>
                            <textarea id="wcText-${toolId}" rows="6" placeholder="Paste or type your text here..."></textarea>
                        </div>
                        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:1rem; text-align:center;" class="tool-results-area">
                            <div><h4 class="glow-text" id="wcWords-${toolId}">0</h4><p>Words</p></div>
                            <div><h4 class="glow-text" id="wcChars-${toolId}">0</h4><p>Characters</p></div>
                            <div><h4 class="glow-text" id="wcCharsNoSpace-${toolId}">0</h4><p>Chars (No Spaces)</p></div>
                            <div><h4 class="glow-text" id="wcSentences-${toolId}">0</h4><p>Sentences</p></div>
                            <div><h4 class="glow-text" id="wcParagraphs-${toolId}">0</h4><p>Paragraphs</p></div>
                        </div>`;
                    const wcText = document.getElementById(`wcText-${toolId}`);
                    const wcWords = document.getElementById(`wcWords-${toolId}`);
                    const wcChars = document.getElementById(`wcChars-${toolId}`);
                    const wcCharsNoSpace = document.getElementById(`wcCharsNoSpace-${toolId}`);
                    const wcSentences = document.getElementById(`wcSentences-${toolId}`);
                    const wcParagraphs = document.getElementById(`wcParagraphs-${toolId}`);
                    wcText.oninput = () => {
                        const text = wcText.value;
                        wcWords.textContent = text.trim() ? text.trim().split(/\s+/).length : 0;
                        wcChars.textContent = text.length;
                        wcCharsNoSpace.textContent = text.replace(/\s/g, '').length;
                        // Improved sentence and paragraph counting
                        wcSentences.textContent = text.trim() ? (text.match(/[^.!?]+[.!?]+(\s|$)/g) || []).length || (text.trim() && 1) : 0;
                        wcParagraphs.textContent = text.trim() ? text.split(/\n\s*\n/).filter(p => p.trim() !== "").length || (text.trim() && 1) : 0;
                    };
                    break;
                
                case 'emi-calculator':
                    modalToolContent.innerHTML = `
                        <div class="tool-input-group">
                            <label for="emiPrincipal-${toolId}">Loan Amount (₹):</label>
                            <input type="number" id="emiPrincipal-${toolId}" placeholder="e.g., 100000" min="1">
                        </div>
                        <div class="tool-input-group">
                            <label for="emiRate-${toolId}">Annual Interest Rate (%):</label>
                            <input type="number" id="emiRate-${toolId}" placeholder="e.g., 8.5" min="0.01" step="0.01">
                        </div>
                        <div class="tool-input-group">
                            <label for="emiTenureYears-${toolId}">Loan Tenure (Years):</label>
                            <input type="number" id="emiTenureYears-${toolId}" placeholder="e.g., 5" min="1">
                        </div>
                        <button id="calculateEmiBtn-${toolId}" class="tool-ui-button" style="width:100%; margin-top:1rem;">Calculate EMI</button>
                        <div id="emiResults-${toolId}" class="tool-results-area" style="display:none; margin-top:1.5rem;">
                            <p>Monthly EMI: <strong id="emiValue-${toolId}"></strong></p>
                            <p>Total Interest Payable: <strong id="totalInterestValue-${toolId}"></strong></p>
                            <p>Total Amount Payable: <strong id="totalAmountValue-${toolId}"></strong></p>
                        </div>`;
                    
                    const emiPrincipalEl = document.getElementById(`emiPrincipal-${toolId}`);
                    const emiRateEl = document.getElementById(`emiRate-${toolId}`);
                    const emiTenureYearsEl = document.getElementById(`emiTenureYears-${toolId}`);
                    const calculateEmiBtn = document.getElementById(`calculateEmiBtn-${toolId}`);
                    const emiResultsEl = document.getElementById(`emiResults-${toolId}`);
                    const emiValueEl = document.getElementById(`emiValue-${toolId}`);
                    const totalInterestValueEl = document.getElementById(`totalInterestValue-${toolId}`);
                    const totalAmountValueEl = document.getElementById(`totalAmountValue-${toolId}`);

                    calculateEmiBtn.onclick = () => {
                        const P = parseFloat(emiPrincipalEl.value);
                        const annualRate = parseFloat(emiRateEl.value);
                        const tenureYears = parseInt(emiTenureYearsEl.value);

                        if (isNaN(P) || P <= 0) {
                            showStatus("Please enter a valid loan amount.", 'error', 3000);
                            emiPrincipalEl.focus(); return;
                        }
                        if (isNaN(annualRate) || annualRate <= 0) {
                            showStatus("Please enter a valid annual interest rate.", 'error', 3000);
                            emiRateEl.focus(); return;
                        }
                        if (isNaN(tenureYears) || tenureYears <= 0) {
                            showStatus("Please enter a valid loan tenure in years.", 'error', 3000);
                            emiTenureYearsEl.focus(); return;
                        }

                        const r = (annualRate / 12) / 100; // Monthly interest rate
                        const n = tenureYears * 12; // Loan tenure in months

                        if (r === 0) { // Handle 0% interest rate
                            const emi = P / n;
                            emiValueEl.textContent = `₹ ${emi.toFixed(2)}`;
                            totalInterestValueEl.textContent = `₹ 0.00`;
                            totalAmountValueEl.textContent = `₹ ${P.toFixed(2)}`;
                            emiResultsEl.style.display = 'block';
                            showStatus("EMI Calculated for 0% interest.", 'success', 3000);
                            return;
                        }
                        
                        const emiNumerator = P * r * Math.pow(1 + r, n);
                        const emiDenominator = Math.pow(1 + r, n) - 1;
                        const emi = emiNumerator / emiDenominator;

                        if (isFinite(emi)) {
                            const totalAmountPayable = emi * n;
                            const totalInterestPayable = totalAmountPayable - P;

                            emiValueEl.textContent = `₹ ${emi.toFixed(2)}`;
                            totalInterestValueEl.textContent = `₹ ${totalInterestPayable.toFixed(2)}`;
                            totalAmountValueEl.textContent = `₹ ${totalAmountPayable.toFixed(2)}`;
                            emiResultsEl.style.display = 'block';
                            showStatus("EMI Calculated!", 'success', 3000);
                        } else {
                            showStatus("Could not calculate EMI. Check inputs or values might be too large/small.", 'error', 4000);
                            emiResultsEl.style.display = 'none';
                        }
                    };
                    break;
                
                case 'timer-stopwatch':
                    modalToolContent.innerHTML = `
                        <div class="timer-stopwatch-tabs">
                            <button id="tsTabStopwatch-${toolId}" class="active" data-panel="stopwatchPanel-${toolId}">Stopwatch</button>
                            <button id="tsTabTimer-${toolId}" data-panel="timerPanel-${toolId}">Timer</button>
                        </div>

                        <div id="stopwatchPanel-${toolId}" class="timer-stopwatch-panel active">
                            <div id="stopwatchDisplay-${toolId}" class="time-display">00:00:00.00</div>
                            <div class="stopwatch-controls">
                                <button id="swStartBtn-${toolId}" class="tool-ui-button"><i class="fas fa-play"></i> Start</button>
                                <button id="swStopBtn-${toolId}" class="tool-ui-button" style="display:none;"><i class="fas fa-pause"></i> Pause</button>
                                <button id="swLapBtn-${toolId}" class="tool-ui-button" style="display:none;"><i class="fas fa-flag"></i> Lap</button>
                                <button id="swResetBtn-${toolId}" class="tool-ui-button"><i class="fas fa-undo"></i> Reset</button>
                            </div>
                            <ol id="swLapsList-${toolId}" class="laps-list"></ol>
                        </div>

                        <div id="timerPanel-${toolId}" class="timer-stopwatch-panel">
                            <div class="tool-input-group timer-inputs">
                                <input type="number" id="timerHours-${toolId}" placeholder="HH" min="0" max="99" value="0"> :
                                <input type="number" id="timerMinutes-${toolId}" placeholder="MM" min="0" max="59" value="5"> :
                                <input type="number" id="timerSeconds-${toolId}" placeholder="SS" min="0" max="59" value="0">
                            </div>
                            <div id="timerDisplay-${toolId}" class="time-display">00:05:00</div>
                            <div class="timer-controls">
                                <button id="timerStartBtn-${toolId}" class="tool-ui-button"><i class="fas fa-play"></i> Start</button>
                                <button id="timerPauseBtn-${toolId}" class="tool-ui-button" style="display:none;"><i class="fas fa-pause"></i> Pause</button>
                                <button id="timerResetBtn-${toolId}" class="tool-ui-button"><i class="fas fa-undo"></i> Reset</button>
                            </div>
                        </div>
                    `;

                    const stopwatchTab = document.getElementById(`tsTabStopwatch-${toolId}`);
                    const timerTab = document.getElementById(`tsTabTimer-${toolId}`);
                    const stopwatchPanel = document.getElementById(`stopwatchPanel-${toolId}`);
                    const timerPanel = document.getElementById(`timerPanel-${toolId}`);

                    function switchTab(activeTab, inactiveTab, activePanel, inactivePanel) {
                        activeTab.classList.add('active'); inactiveTab.classList.remove('active');
                        activePanel.classList.add('active'); inactivePanel.classList.remove('active');
                    }
                    stopwatchTab.onclick = () => switchTab(stopwatchTab, timerTab, stopwatchPanel, timerPanel);
                    timerTab.onclick = () => switchTab(timerTab, stopwatchTab, timerPanel, stopwatchPanel);
                    
                    const swDisplay = document.getElementById(`stopwatchDisplay-${toolId}`);
                    const swStartBtn = document.getElementById(`swStartBtn-${toolId}`);
                    const swStopBtn = document.getElementById(`swStopBtn-${toolId}`);
                    const swLapBtn = document.getElementById(`swLapBtn-${toolId}`);
                    const swResetBtn = document.getElementById(`swResetBtn-${toolId}`);
                    const swLapsList = document.getElementById(`swLapsList-${toolId}`);
                    let swInterval, swStartTime, swElapsedTime = 0, swLapStartTime = 0, swLaps = [];

                    function formatTime(ms, includeMs = true) {
                        let totalSeconds = Math.floor(ms / 1000);
                        let hours = Math.floor(totalSeconds / 3600);
                        let minutes = Math.floor((totalSeconds % 3600) / 60);
                        let seconds = totalSeconds % 60;
                        let milliseconds = Math.floor((ms % 1000) / 10); // Display centiseconds (2 digits)
                        return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}` +
                               (includeMs ? `.${String(milliseconds).padStart(2, '0')}` : '');
                    }
                    swStartBtn.onclick = () => {
                        swStartTime = Date.now() - swElapsedTime; 
                        swLapStartTime = swLapStartTime === 0 ? swStartTime : Date.now() - (swElapsedTime - (swLaps.reduce((acc, lap) => acc + lap.rawTime, 0) || 0)); // Adjust lap start time
                        
                        swInterval = setInterval(() => { swElapsedTime = Date.now() - swStartTime; swDisplay.textContent = formatTime(swElapsedTime); }, 10);
                        currentToolIntervals.push(swInterval);
                        swStartBtn.style.display = 'none'; swStopBtn.style.display = 'inline-block'; swLapBtn.style.display = 'inline-block';
                    };
                    swStopBtn.onclick = () => { clearInterval(swInterval); swStartBtn.style.display = 'inline-block'; swStopBtn.style.display = 'none';};
                    swResetBtn.onclick = () => {
                        clearInterval(swInterval); swElapsedTime = 0; swLaps = []; swLapStartTime = 0;
                        swDisplay.textContent = formatTime(0); swLapsList.innerHTML = '';
                        swStartBtn.style.display = 'inline-block'; swStopBtn.style.display = 'none'; swLapBtn.style.display = 'none';
                    };
                    swLapBtn.onclick = () => {
                        const currentTotalTime = swElapsedTime;
                        const previousLapsTotalTime = swLaps.reduce((acc, lap) => acc + lap.rawTime, 0);
                        const currentLapRawTime = currentTotalTime - previousLapsTotalTime;
                        
                        swLaps.push({ time: formatTime(currentLapRawTime), rawTime: currentLapRawTime });
                        const li = document.createElement('li'); 
                        li.textContent = `Lap ${swLaps.length}: ${swLaps[swLaps.length - 1].time}`;
                        swLapsList.prepend(li); 
                        // swLapStartTime is managed relative to swElapsedTime in start
                    };
                    
                    const timerHoursInput = document.getElementById(`timerHours-${toolId}`);
                    const timerMinutesInput = document.getElementById(`timerMinutes-${toolId}`);
                    const timerSecondsInput = document.getElementById(`timerSeconds-${toolId}`);
                    const timerDisplay = document.getElementById(`timerDisplay-${toolId}`);
                    const timerStartBtn = document.getElementById(`timerStartBtn-${toolId}`);
                    const timerPauseBtn = document.getElementById(`timerPauseBtn-${toolId}`);
                    const timerResetBtn = document.getElementById(`timerResetBtn-${toolId}`);
                    let timerInterval, timerTargetTime, timerRemainingMs, initialTimerDurationMs;

                    function updateTimerDisplay() { timerDisplay.textContent = formatTime(timerRemainingMs, false); }
                    
                    function setInitialTimerDuration() {
                        const h = Math.max(0, parseInt(timerHoursInput.value) || 0); 
                        const m = Math.max(0, Math.min(59, parseInt(timerMinutesInput.value) || 0)); 
                        const s = Math.max(0, Math.min(59, parseInt(timerSecondsInput.value) || 0));
                        timerHoursInput.value = h; timerMinutesInput.value = m; timerSecondsInput.value = s; // Normalize input values
                        initialTimerDurationMs = (h * 3600 + m * 60 + s) * 1000;
                        return initialTimerDurationMs;
                    }
                    function resetTimerState() {
                        timerRemainingMs = setInitialTimerDuration();
                        updateTimerDisplay();
                        [timerHoursInput, timerMinutesInput, timerSecondsInput].forEach(inp => inp.disabled = false);
                        timerStartBtn.style.display = 'inline-block'; timerPauseBtn.style.display = 'none';
                    }

                    [timerHoursInput, timerMinutesInput, timerSecondsInput].forEach(input => input.oninput = resetTimerState);
                    resetTimerState(); // Call on load

                    timerStartBtn.onclick = () => {
                        if (timerRemainingMs <= 0) { // If timer was at 0, reset it from inputs
                            resetTimerState();
                            if (timerRemainingMs <= 0) { // If still 0 after reset from inputs
                                showStatus("Set a positive duration for the timer.", 'error', 3000); return; 
                            }
                        }
                        timerTargetTime = Date.now() + timerRemainingMs;
                        timerInterval = setInterval(() => {
                            timerRemainingMs = Math.max(0, timerTargetTime - Date.now());
                            updateTimerDisplay();
                            if (timerRemainingMs <= 0) {
                                clearInterval(timerInterval); 
                                showStatus('Timer Finished!', 'success', 5000); // Use showStatus
                                try {
                                    new Audio('https://interactive-examples.mdn.mozilla.net/media/cc0-audio/t-rex-roar.mp3').play(); // Example sound
                                } catch(e) { console.warn("Could not play timer sound", e)}
                                resetTimerState();
                            }
                        }, 200); // Update display more frequently for smoother countdown
                        currentToolIntervals.push(timerInterval);
                        timerStartBtn.style.display = 'none'; timerPauseBtn.style.display = 'inline-block';
                        [timerHoursInput, timerMinutesInput, timerSecondsInput].forEach(inp => inp.disabled = true);
                    };
                    timerPauseBtn.onclick = () => {
                        clearInterval(timerInterval); 
                        timerStartBtn.style.display = 'inline-block'; timerPauseBtn.style.display = 'none';
                        // Keep inputs disabled to resume from paused state
                    };
                    timerResetBtn.onclick = () => {
                        clearInterval(timerInterval); 
                        resetTimerState();
                    };
                    break;
                
                case 'age-calculator':
                    modalToolContent.innerHTML = `
                        <div class="tool-input-group">
                            <label for="dob-${toolId}">Date of Birth:</label>
                            <input type="date" id="dob-${toolId}">
                        </div>
                        <div class="tool-input-group">
                            <label for="ageAtDate-${toolId}">Age at the Date of:</label>
                            <input type="date" id="ageAtDate-${toolId}">
                        </div>
                        <button id="calculateAgeBtn-${toolId}" class="tool-ui-button" style="width:100%; margin-top:1rem;">Calculate Age</button>
                        <div id="ageResults-${toolId}" class="tool-results-area" style="display:none; margin-top:1.5rem;">
                            <h4>Your Age Is:</h4>
                            <p id="ageYMD-${toolId}"></p>
                            <hr style="border-color: var(--accent-cyan); opacity: 0.3; margin: 1rem 0;">
                            <h4>Summary:</h4>
                            <div class="age-summary-grid">
                                <p>Years: <strong id="totalYears-${toolId}"></strong></p>
                                <p>Months: <strong id="totalMonths-${toolId}"></strong></p>
                                <p>Weeks: <strong id="totalWeeks-${toolId}"></strong></p>
                                <p>Days: <strong id="totalDays-${toolId}"></strong></p>
                                <p>Hours: <strong id="totalHours-${toolId}"></strong></p>
                                <p>Minutes: <strong id="totalMinutes-${toolId}"></strong></p>
                            </div>
                            <hr style="border-color: var(--accent-cyan); opacity: 0.3; margin: 1rem 0;">
                            <p>Next Birthday: <strong id="nextBirthday-${toolId}"></strong></p>
                        </div>
                    `;

                    const dobInput = document.getElementById(`dob-${toolId}`);
                    const ageAtDateInput = document.getElementById(`ageAtDate-${toolId}`);
                    const calculateAgeBtn = document.getElementById(`calculateAgeBtn-${toolId}`);
                    const ageResultsEl = document.getElementById(`ageResults-${toolId}`);
                    const ageYMDOutput = document.getElementById(`ageYMD-${toolId}`);
                    const totalYearsOutput = document.getElementById(`totalYears-${toolId}`);
                    const totalMonthsOutput = document.getElementById(`totalMonths-${toolId}`);
                    const totalWeeksOutput = document.getElementById(`totalWeeks-${toolId}`);
                    const totalDaysOutput = document.getElementById(`totalDays-${toolId}`);
                    const totalHoursOutput = document.getElementById(`totalHours-${toolId}`);
                    const totalMinutesOutput = document.getElementById(`totalMinutes-${toolId}`);
                    const nextBirthdayOutput = document.getElementById(`nextBirthday-${toolId}`);

                    // Set default "Age at Date of" to today and max for DoB to today
                    const today = new Date();
                    const todayString = today.toISOString().split('T')[0];
                    ageAtDateInput.value = todayString;
                    dobInput.max = todayString;


                    calculateAgeBtn.onclick = () => {
                        const dobString = dobInput.value;
                        const ageAtDateString = ageAtDateInput.value;

                        if (!dobString) { showStatus("Please select your Date of Birth.", 'error', 3000); dobInput.focus(); return; }
                        if (!ageAtDateString) { showStatus("Please select the 'Age at Date of'.", 'error', 3000); ageAtDateInput.focus(); return; }

                        const dob = new Date(dobString + "T00:00:00"); // Ensure time is start of day
                        const ageAtDate = new Date(ageAtDateString + "T00:00:00");

                        if (dob > ageAtDate) { showStatus("Date of Birth cannot be after the 'Age at Date of'.", 'error', 4000); ageResultsEl.style.display = 'none'; return; }

                        let years = ageAtDate.getFullYear() - dob.getFullYear();
                        let months = ageAtDate.getMonth() - dob.getMonth();
                        let days = ageAtDate.getDate() - dob.getDate();

                        if (days < 0) {
                            months--;
                            // Get days in previous month of ageAtDate
                            days += new Date(ageAtDate.getFullYear(), ageAtDate.getMonth(), 0).getDate();
                        }
                        if (months < 0) { years--; months += 12; }

                        ageYMDOutput.textContent = `${years} years, ${months} months, and ${days} days`;

                        const diffMs = ageAtDate.getTime() - dob.getTime();
                        const totalDaysVal = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                        totalYearsOutput.textContent = years;
                        totalMonthsOutput.textContent = (years * 12) + months;
                        totalWeeksOutput.textContent = Math.floor(totalDaysVal / 7);
                        totalDaysOutput.textContent = totalDaysVal.toLocaleString();
                        totalHoursOutput.textContent = (totalDaysVal * 24).toLocaleString();
                        totalMinutesOutput.textContent = (totalDaysVal * 24 * 60).toLocaleString();

                        let nextBdayYear = ageAtDate.getFullYear();
                        let nextBday = new Date(nextBdayYear, dob.getMonth(), dob.getDate());
                        
                        // If birthday this year has passed or is today, check next year
                        if (nextBday.getTime() < ageAtDate.getTime() || (nextBday.getTime() === ageAtDate.getTime() && dob.getDate() === ageAtDate.getDate() && (dob.getMonth() === ageAtDate.getMonth() && dob.getFullYear() !== ageAtDate.getFullYear()) )) {
                             // This condition handles if it IS the birthday today
                            if (dob.getMonth() === ageAtDate.getMonth() && dob.getDate() === ageAtDate.getDate()){
                                // it's their birthday today!
                            } else {
                                nextBday.setFullYear(nextBdayYear + 1);
                            }
                        } else if (nextBday.getTime() < ageAtDate.getTime()) {
                             nextBday.setFullYear(nextBdayYear + 1);
                        }


                        const daysToNextBday = Math.ceil((nextBday.getTime() - ageAtDate.getTime()) / (1000 * 60 * 60 * 24));
                        const dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
                        
                        if (dob.getMonth() === ageAtDate.getMonth() && dob.getDate() === ageAtDate.getDate()) {
                             nextBirthdayOutput.textContent = `Happy Birthday! Today is ${dayNames[nextBday.getDay()]}.`;
                        } else {
                             nextBirthdayOutput.textContent = `${dayNames[nextBday.getDay()]}, in ${daysToNextBday} day(s)`;
                        }
                        
                        ageResultsEl.style.display = 'block';
                        showStatus("Age Calculated!", 'success', 3000);
                    };
                    break;
                
                case 'audio-converter':
                    modalToolContent.innerHTML = createFileUploadUI('audio/*', false, toolId) +
                        `<div class="tool-input-group" style="margin-top:1rem;">
                            <label for="audioConvertTo-${toolId}">Convert to: </label>
                            <select id="audioConvertTo-${toolId}">
                                <option value="mp3">MP3</option>
                                <option value="wav">WAV</option>
                                <option value="ogg">OGG (Vorbis)</option>
                                <option value="aac">AAC</option>
                                <option value="flac">FLAC</option>
                                <option value="m4a">M4A (AAC)</option>
                            </select>
                        </div>`;
                    const audioConverterHandler = setupFileHandling(toolId);
                    if(audioConverterHandler.processBtn) {
                        const audioConvertToSelect = document.getElementById(`audioConvertTo-${toolId}`);
                        audioConverterHandler.processBtn.textContent = "Convert Audio (Simulated)";
                        audioConverterHandler.processBtn.onclick = () => {
                            const files = audioConverterHandler.getFiles();
                            if (files.length === 0) { showStatus('Please select an audio file.', 'error', 3000); return; }
                            const file = files[0];
                            const targetFormat = audioConvertToSelect.value;
                            
                            simulateProcessing(toolName, () => {
                                const outputFileName = `${file.name.substring(0, file.name.lastIndexOf('.')) || file.name}_converted.${targetFormat}`;
                                const fakeBlob = new Blob([`Simulated ${targetFormat.toUpperCase()} audio data for ${file.name}`], { type: `audio/${targetFormat}` });
                                downloadFile(fakeBlob, outputFileName);
                                audioConverterHandler.clearFiles();
                            }, 1);
                        };
                    }
                    break;
                
                case 'video-compressor':
                    modalToolContent.innerHTML = createFileUploadUI('video/*', false, toolId) +
                        `<div class="tool-input-group" style="margin-top:1rem;">
                            <label for="videoQuality-${toolId}">Target Quality: </label>
                            <select id="videoQuality-${toolId}">
                                <option value="low">Low (Smaller Size)</option>
                                <option value="medium" selected>Medium (Balanced)</option>
                                <option value="high">High (Better Quality)</option>
                            </select>
                        </div>`;
                    const videoCompressorHandler = setupFileHandling(toolId);
                    if(videoCompressorHandler.processBtn) {
                        const videoQualitySelect = document.getElementById(`videoQuality-${toolId}`);
                        videoCompressorHandler.processBtn.textContent = "Compress Video (Simulated)";
                        videoCompressorHandler.processBtn.onclick = () => {
                            const files = videoCompressorHandler.getFiles();
                            if (files.length === 0) { showStatus('Please select a video file.', 'error', 3000); return; }
                            const file = files[0];
                            const targetQuality = videoQualitySelect.value;
                            
                            simulateProcessing(toolName, () => {
                                // Keep original extension or use mp4 as a common fallback
                                const originalExtension = file.name.substring(file.name.lastIndexOf('.') + 1) || 'mp4';
                                const outputFileName = `${file.name.substring(0, file.name.lastIndexOf('.')) || file.name}_compressed_${targetQuality}.${originalExtension}`;
                                const fakeBlob = new Blob([`Simulated compressed video data (${targetQuality} quality) for ${file.name}`], { type: file.type || 'video/mp4' });
                                downloadFile(fakeBlob, outputFileName);
                                videoCompressorHandler.clearFiles();
                            }, 1);
                        };
                    }
                    break;

                case 'color-picker':
                    modalToolContent.innerHTML = `
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 1rem;">
                            <div class="tool-input-group" style="width: 100%; text-align: center;">
                                <label for="colorPickerInput-${toolId}" class="glow-text-hover" style="font-size:1.2rem; cursor:pointer;">Select Color:</label>
                                <input type="color" id="colorPickerInput-${toolId}" value="#42f8f5" style="width: 100px; height: 100px; border: none; padding: 0; cursor: pointer; border-radius: 8px; box-shadow: 0 0 10px var(--glow-shadow-weak); margin-top:0.5rem;">
                            </div>

                            <div id="colorPreview-${toolId}" style="width: 150px; height: 150px; border-radius: 8px; border: 2px solid var(--accent-cyan); margin-bottom: 1rem; box-shadow: 0 0 15px var(--glow-shadow-color); transition: background-color 0.3s ease;">
                            </div>

                            <div style="width:100%; display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem;">
                                <div class="tool-input-group">
                                    <label for="hexValue-${toolId}">HEX:</label>
                                    <input type="text" id="hexValue-${toolId}" readonly style="text-align:center;">
                                    <button class="tool-ui-button copy-color-btn" data-target="hexValue-${toolId}" style="margin-top:0.5rem; width:100%; font-size:0.8rem; padding:0.5rem;">Copy HEX</button>
                                </div>
                                <div class="tool-input-group">
                                    <label for="rgbValue-${toolId}">RGB:</label>
                                    <input type="text" id="rgbValue-${toolId}" readonly style="text-align:center;">
                                    <button class="tool-ui-button copy-color-btn" data-target="rgbValue-${toolId}" style="margin-top:0.5rem; width:100%; font-size:0.8rem; padding:0.5rem;">Copy RGB</button>
                                </div>
                                <div class="tool-input-group">
                                    <label for="hslValue-${toolId}">HSL:</label>
                                    <input type="text" id="hslValue-${toolId}" readonly style="text-align:center;">
                                    <button class="tool-ui-button copy-color-btn" data-target="hslValue-${toolId}" style="margin-top:0.5rem; width:100%; font-size:0.8rem; padding:0.5rem;">Copy HSL</button>
                                </div>
                            </div>
                        </div>
                    `;

                    const colorInput = document.getElementById(`colorPickerInput-${toolId}`);
                    const colorPreview = document.getElementById(`colorPreview-${toolId}`);
                    const hexOutput = document.getElementById(`hexValue-${toolId}`);
                    const rgbOutput = document.getElementById(`rgbValue-${toolId}`);
                    const hslOutput = document.getElementById(`hslValue-${toolId}`);

                    function updateColorValues(hexColor) {
                        colorPreview.style.backgroundColor = hexColor;
                        hexOutput.value = hexColor.toUpperCase();

                        const rgb = hexToRgb(hexColor);
                        if (rgb) {
                            rgbOutput.value = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                            const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
                            hslOutput.value = `hsl(${hsl.h}, ${hsl.s}%, ${hsl.l}%)`;
                        } else {
                            rgbOutput.value = "Invalid HEX";
                            hslOutput.value = "Invalid HEX";
                        }
                    }

                    colorInput.addEventListener('input', (event) => {
                        updateColorValues(event.target.value);
                    });
                    updateColorValues(colorInput.value); // Initial update

                    const copyButtons = modalToolContent.querySelectorAll('.copy-color-btn');
                    copyButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const targetInputId = button.dataset.target;
                            const inputToCopy = document.getElementById(targetInputId);
                            if (inputToCopy && inputToCopy.value && !inputToCopy.value.includes("Invalid")) {
                                navigator.clipboard.writeText(inputToCopy.value)
                                    .then(() => {
                                        let type = "Value";
                                        if (targetInputId.includes("hex")) type = "HEX";
                                        else if (targetInputId.includes("rgb")) type = "RGB";
                                        else if (targetInputId.includes("hsl")) type = "HSL";
                                        showStatus(`${type} Copied!`, 'success', 2000);
                                    })
                                    .catch(err => showStatus('Failed to copy.', 'error', 2000));
                            } else {
                                showStatus('Nothing valid to copy.', 'error', 2000);
                            }
                        });
                    });
                    break;
                
                case 'unit-converter':
                    const ucConversionFactors = {
                        length: {
                            meter:      { factor: 1, display: "Meter (m)" },
                            kilometer:  { factor: 1000, display: "Kilometer (km)" },
                            centimeter: { factor: 0.01, display: "Centimeter (cm)" },
                            millimeter: { factor: 0.001, display: "Millimeter (mm)" },
                            mile:       { factor: 1609.34, display: "Mile (mi)" },
                            yard:       { factor: 0.9144, display: "Yard (yd)" },
                            foot:       { factor: 0.3048, display: "Foot (ft)" },
                            inch:       { factor: 0.0254, display: "Inch (in)" }
                        },
                        weight: { // Base: Kilogram
                            kilogram:   { factor: 1, display: "Kilogram (kg)" },
                            gram:       { factor: 0.001, display: "Gram (g)" },
                            milligram:  { factor: 0.000001, display: "Milligram (mg)" },
                            pound:      { factor: 0.45359237, display: "Pound (lb)" },
                            ounce:      { factor: 0.0283495231, display: "Ounce (oz)" },
                            tonne:      { factor: 1000, display: "Tonne (t)"}
                        },
                        temperature: { // Base for temperature is Celsius for internal calculation
                            celsius:    { toBase: (c) => c, fromBase: (base) => base, display: "Celsius (°C)" },
                            fahrenheit: { toBase: (f) => (f - 32) * 5/9, fromBase: (base) => (base * 9/5) + 32, display: "Fahrenheit (°F)" },
                            kelvin:     { toBase: (k) => k - 273.15, fromBase: (base) => base + 273.15, display: "Kelvin (K)" }
                        },
                        area: { // Base: Square Meter
                            sqMeter:    { factor: 1, display: "Square Meter (m²)"},
                            sqKilometer:{ factor: 1000000, display: "Square Kilometer (km²)"},
                            sqCentimeter:{ factor: 0.0001, display: "Square Centimeter (cm²)"},
                            sqMile:     { factor: 2589988.110336, display: "Square Mile (mi²)"},
                            sqYard:     { factor: 0.83612736, display: "Square Yard (yd²)"},
                            sqFoot:     { factor: 0.09290304, display: "Square Foot (ft²)"},
                            acre:       { factor: 4046.8564224, display: "Acre (ac)"},
                            hectare:    { factor: 10000, display: "Hectare (ha)"}
                        },
                        volume: { // Base: Liter
                            liter:      { factor: 1, display: "Liter (L)"},
                            milliliter: { factor: 0.001, display: "Milliliter (mL)"},
                            cubicMeter: { factor: 1000, display: "Cubic Meter (m³)"},
                            cubicCentimeter: { factor: 0.001, display: "Cubic Centimeter (cm³)"}, // Same as mL
                            gallonUS:   { factor: 3.785411784, display: "Gallon (US fluid)"},
                            quartUS:    { factor: 0.946352946, display: "Quart (US fluid)"},
                            pintUS:     { factor: 0.473176473, display: "Pint (US fluid)"},
                            cupUS:      { factor: 0.2365882365, display: "Cup (US)"},
                            fluidOunceUS: { factor: 0.02957352956, display: "Fluid Ounce (US)"}
                        }
                    };

                    modalToolContent.innerHTML = `
                        <div class="tool-input-group">
                            <label for="ucCategory-${toolId}">Select Category:</label>
                            <select id="ucCategory-${toolId}"></select>
                        </div>
                        <div class="unit-converter-grid">
                            <div class="tool-input-group">
                                <label for="ucFromValue-${toolId}">From:</label>
                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="number" id="ucFromValue-${toolId}" placeholder="Enter value" style="flex-grow: 1;">
                                    <select id="ucFromUnit-${toolId}" style="min-width: 120px;"></select>
                                </div>
                            </div>
                            <div class="swap-btn-container">
                                <button id="ucSwapBtn-${toolId}" class="tool-ui-button" aria-label="Swap units"><i class="fas fa-exchange-alt"></i></button>
                            </div>
                            <div class="tool-input-group">
                                <label for="ucToValue-${toolId}">To:</label>
                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="number" id="ucToValue-${toolId}" placeholder="Result" readonly style="flex-grow: 1;">
                                    <select id="ucToUnit-${toolId}" style="min-width: 120px;"></select>
                                </div>
                            </div>
                        </div>
                        <div id="ucFormulaDisplay-${toolId}" style="margin-top:1rem; text-align:center; font-size:0.9rem; color: var(--text-secondary); min-height:1.5em;"></div>
                    `;

                    const ucCategorySelect = document.getElementById(`ucCategory-${toolId}`);
                    const ucFromValueInput = document.getElementById(`ucFromValue-${toolId}`);
                    const ucFromUnitSelect = document.getElementById(`ucFromUnit-${toolId}`);
                    const ucToValueInput = document.getElementById(`ucToValue-${toolId}`);
                    const ucToUnitSelect = document.getElementById(`ucToUnit-${toolId}`);
                    const ucSwapBtn = document.getElementById(`ucSwapBtn-${toolId}`);
                    const ucFormulaDisplay = document.getElementById(`ucFormulaDisplay-${toolId}`);

                    function populateUcCategorySelect() {
                        for (const categoryKey in ucConversionFactors) {
                            const option = createOption(categoryKey, categoryKey.charAt(0).toUpperCase() + categoryKey.slice(1));
                            ucCategorySelect.appendChild(option);
                        }
                    }

                    function populateUcUnitSelects(category) {
                        ucFromUnitSelect.innerHTML = '';
                        ucToUnitSelect.innerHTML = '';
                        const units = ucConversionFactors[category];
                        let count = 0;
                        for (const unitKey in units) {
                            const unitData = units[unitKey];
                            const option = createOption(unitKey, unitData.display);
                            ucFromUnitSelect.appendChild(option.cloneNode(true));
                            ucToUnitSelect.appendChild(option.cloneNode(true));
                            count++;
                        }
                        if (count > 0) {
                            ucFromUnitSelect.selectedIndex = 0;
                            ucToUnitSelect.selectedIndex = Math.min(1, count - 1); // Select 2nd if available, else 1st
                        }
                    }
                    
                    function performUcConversion() {
                        const fromValueStr = ucFromValueInput.value;
                        if (fromValueStr.trim() === '') {
                            ucToValueInput.value = '';
                            ucFormulaDisplay.textContent = '';
                            return;
                        }

                        const fromValue = parseFloat(fromValueStr);
                        if (isNaN(fromValue)) {
                            ucToValueInput.value = 'Invalid Input';
                            ucFormulaDisplay.textContent = '';
                            return;
                        }

                        const category = ucCategorySelect.value;
                        const fromUnitKey = ucFromUnitSelect.value;
                        const toUnitKey = ucToUnitSelect.value;
                        const unitsInCategory = ucConversionFactors[category];

                        if (!unitsInCategory || !unitsInCategory[fromUnitKey] || !unitsInCategory[toUnitKey]) {
                            ucToValueInput.value = 'Error';
                            ucFormulaDisplay.textContent = 'Unit configuration error.';
                            console.error("Unit config error:", category, fromUnitKey, toUnitKey, unitsInCategory);
                            return;
                        }
                        
                        let result;
                        const fromUnitData = unitsInCategory[fromUnitKey];
                        const toUnitData = unitsInCategory[toUnitKey];

                        if (category === 'temperature') {
                            const baseValue = fromUnitData.toBase(fromValue);
                            result = toUnitData.fromBase(baseValue);
                        } else {
                            const baseValue = fromValue * fromUnitData.factor; // Convert to category's base unit
                            result = baseValue / toUnitData.factor;     // Convert from base to target unit
                        }
                        
                        // Smart formatting for result
                        if (Math.abs(result) > 1e7 || (Math.abs(result) < 1e-5 && result !== 0)) {
                           ucToValueInput.value = result.toExponential(5);
                        } else {
                           let precision = 7;
                           if (Math.abs(result) < 1) precision = Math.max(5, Math.min(10, -Math.floor(Math.log10(Math.abs(result))) + 4));
                           ucToValueInput.value = parseFloat(result.toFixed(precision));
                        }


                        // Update formula display
                        if (fromUnitKey !== toUnitKey && !isNaN(fromValue) && fromValue !== 0) {
                            let conversionRate;
                            if (category === 'temperature') {
                                 ucFormulaDisplay.textContent = `Converting ${fromUnitData.display} to ${toUnitData.display}`;
                            } else {
                                conversionRate = fromUnitData.factor / toUnitData.factor;
                                if (isFinite(conversionRate)) {
                                    let fromUnitDisplayName = fromUnitData.display.split('(')[0].trim();
                                    let toUnitDisplayName = toUnitData.display.split('(')[0].trim();
                                     ucFormulaDisplay.textContent = `1 ${fromUnitDisplayName} ≈ ${parseFloat(conversionRate.toPrecision(5))} ${toUnitDisplayName}`;
                                } else {
                                     ucFormulaDisplay.textContent = `Converting ${fromUnitData.display} to ${toUnitData.display}`;
                                }
                            }
                        } else if (fromUnitKey === toUnitKey) {
                            ucFormulaDisplay.textContent = `Units are the same.`;
                        } else {
                            ucFormulaDisplay.textContent = '';
                        }
                    }

                    ucCategorySelect.addEventListener('change', () => {
                        populateUcUnitSelects(ucCategorySelect.value);
                        performUcConversion();
                    });

                    ucFromValueInput.addEventListener('input', performUcConversion);
                    ucFromUnitSelect.addEventListener('change', performUcConversion);
                    ucToUnitSelect.addEventListener('change', performUcConversion);

                    ucSwapBtn.addEventListener('click', () => {
                        const tempFromUnit = ucFromUnitSelect.value;
                        ucFromUnitSelect.value = ucToUnitSelect.value;
                        ucToUnitSelect.value = tempFromUnit;
                        performUcConversion();
                    });

                    populateUcCategorySelect();
                    if (ucCategorySelect.options.length > 0) {
                        ucCategorySelect.value = ucCategorySelect.options[0].value; // Default to first category
                        populateUcUnitSelects(ucCategorySelect.value);
                        performUcConversion(); // Initial conversion if any default value in input
                    }
                    break; 

                case 'speech-to-text':
                    modalToolContent.innerHTML = `
                        <div class="tool-input-group">
                            <label for="sttLanguage-${toolId}">Language:</label>
                            <select id="sttLanguage-${toolId}" style="margin-bottom: 0.5rem;">
                                <option value="en-US">English (US)</option>
                                <option value="en-GB">English (UK)</option>
                                <option value="es-ES">Español (España)</option>
                                <option value="es-MX">Español (México)</option>
                                <option value="fr-FR">Français (France)</option>
                                <option value="de-DE">Deutsch (Deutschland)</option>
                                <option value="it-IT">Italiano (Italia)</option>
                                <option value="ja-JP">日本語 (日本)</option>
                                <option value="ko-KR">한국어 (대한민국)</option>
                                <option value="zh-CN">中文 (简体)</option>
                                <option value="zh-TW">中文 (繁體)</option>
                                <option value="pt-BR">Português (Brasil)</option>
                                <option value="ru-RU">Русский (Россия)</option>
                                <option value="hi-IN">हिन्दी (भारत)</option>
                                <option value="ar-SA">العربية (السعودية)</option>
                                <!-- Add more languages as needed -->
                            </select>
                        </div>
                        <div class="tool-input-group">
                            <label for="sttOutput-${toolId}">Transcribed Text:</label>
                            <textarea id="sttOutput-${toolId}" rows="8" placeholder="Speech will be transcribed here..." style="margin-bottom: 0.5rem;"></textarea>
                            <button id="sttCopyBtn-${toolId}" class="tool-ui-button" style="width:100%; font-size:0.9rem; padding: 0.6rem 1rem;">Copy Text</button>
                        </div>
                        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                            <button id="sttStartBtn-${toolId}" class="tool-ui-button" style="flex-grow:1;"><i class="fas fa-microphone-alt"></i> Start Listening</button>
                            <button id="sttStopBtn-${toolId}" class="tool-ui-button" style="flex-grow:1; display:none; background-color: var(--sidebar-bg);"><i class="fas fa-stop-circle"></i> Stop Listening</button>
                        </div>
                        <div id="sttStatus-${toolId}" style="margin-top: 1rem; text-align: center; color: var(--text-secondary); min-height: 1.5em;"></div>
                    `;
                    console.log('[STT] Initializing Speech-to-Text tool'); 

                    const sttLanguageSelectEl = document.getElementById(`sttLanguage-${toolId}`);
                    const sttOutputTextareaEl = document.getElementById(`sttOutput-${toolId}`);
                    const sttCopyBtn = document.getElementById(`sttCopyBtn-${toolId}`);
                    const sttStartBtnEl = document.getElementById(`sttStartBtn-${toolId}`);
                    const sttStopBtnEl = document.getElementById(`sttStopBtn-${toolId}`);
                    const sttStatusEl = document.getElementById(`sttStatus-${toolId}`);

                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    let recognition;
                    let currentFinalTranscript = '';
                    let isListening = false;

                    if (!SpeechRecognition) {
                        console.error('[STT] SpeechRecognition API not supported.'); 
                        sttStatusEl.innerHTML = '<span style="color:red;">Speech Recognition API not supported in this browser. Try Chrome or Edge.</span>';
                        sttStartBtnEl.disabled = true;
                        if (sttCopyBtn) sttCopyBtn.disabled = true;
                        modalToolStatus.style.display = 'none'; // Ensure main modal status is hidden
                        break; 
                    }

                    recognition = new SpeechRecognition();
                    recognition.continuous = true; // Keep listening even after pauses
                    recognition.interimResults = true; // Get results as they come
                    console.log('[STT] SpeechRecognition instance created.'); 

                    recognition.onstart = () => {
                        console.log('[STT] onstart event fired.'); 
                        isListening = true;
                        sttStatusEl.textContent = 'Listening... Speak now.';
                        sttStartBtnEl.style.display = 'none';
                        sttStopBtnEl.style.display = 'block';
                        sttOutputTextareaEl.focus();
                        showStatus('Listening...', 'processing'); // Use main modal status
                    };

                    recognition.onresult = (event) => {
                        console.log('[STT] onresult event fired.', event); 
                        let interim_transcript = '';
                        // currentFinalTranscript is reset at start, so just build from this event's final results
                        let latestFinalTranscriptPart = ''; 
                        for (let i = event.resultIndex; i < event.results.length; ++i) {
                            if (event.results[i].isFinal) {
                                latestFinalTranscriptPart += event.results[i][0].transcript + ' ';
                            } else {
                                interim_transcript += event.results[i][0].transcript;
                            }
                        }
                        currentFinalTranscript += latestFinalTranscriptPart; // Append new final parts
                        sttOutputTextareaEl.value = currentFinalTranscript + interim_transcript;
                        console.log('[STT] Interim: "' + interim_transcript + '", Current Final: "' + currentFinalTranscript + '"');
                    };

                    recognition.onend = () => {
                        console.log('[STT] onend event fired.'); 
                        isListening = false;
                        sttStatusEl.textContent = 'Stopped listening. Click "Start Listening" to try again.';
                        sttStartBtnEl.style.display = 'block';
                        sttStopBtnEl.style.display = 'none';
                        if (currentFinalTranscript.trim() !== '' || sttOutputTextareaEl.value.trim() !== '') {
                            showStatus('Transcription complete.', 'success', 3000);
                        } else {
                             showStatus('Stopped.', 'info', 2000); 
                        }
                    };

                    recognition.onerror = (event) => {
                        console.error('[STT] onerror event fired:', event.error, event.message); 
                        isListening = false;
                        let errorMessage = 'An error occurred: ' + event.error;
                        if (event.error === 'no-speech') {
                            errorMessage = 'No speech detected. Please try again.';
                        } else if (event.error === 'audio-capture') {
                            errorMessage = 'Audio capture failed. Check microphone permissions and ensure no other app is using it.';
                        } else if (event.error === 'not-allowed') {
                            errorMessage = 'Microphone access denied. Please allow microphone access in browser settings or ensure HTTPS.';
                        } else if (event.error === 'network') {
                            errorMessage = 'Network error. Speech recognition might require an internet connection.';
                        } else if (event.error === 'language-not-supported') {
                            errorMessage = `The selected language (${recognition.lang || 'default'}) may not be supported.`;
                        }
                        sttStatusEl.innerHTML = `<span style="color:red;">${errorMessage}</span>`;
                        sttStartBtnEl.style.display = 'block';
                        sttStopBtnEl.style.display = 'none';
                        showStatus(`Error: ${event.error}`, 'error', 5000);
                    };

                    sttStartBtnEl.onclick = () => {
                        console.log('[STT] Start button clicked.'); 
                        if (isListening) {
                            console.warn('[STT] Already listening, start command ignored.');
                            return;
                        }
                        recognition.lang = sttLanguageSelectEl.value;
                        console.log('[STT] Language set to:', recognition.lang); 
                        currentFinalTranscript = ''; // Reset transcript for new session
                        sttOutputTextareaEl.value = ''; // Clear textarea for new session

                        try {
                            recognition.start();
                            console.log('[STT] recognition.start() called.'); 
                        } catch (e) {
                            console.error('[STT] Error calling recognition.start():', e); 
                            sttStatusEl.innerHTML = `<span style="color:red;">Could not start recognition: ${e.message}</span>`;
                            showStatus('Error starting recognition.', 'error', 3000);
                        }
                    };

                    sttStopBtnEl.onclick = () => {
                        console.log('[STT] Stop button clicked.'); 
                        if (!isListening) {
                            console.warn('[STT] Not listening, stop command ignored.');
                            return;
                        }
                        recognition.stop();
                        console.log('[STT] recognition.stop() called.'); 
                    };

                    if (sttCopyBtn) {
                        sttCopyBtn.onclick = () => {
                            if (sttOutputTextareaEl.value) {
                                navigator.clipboard.writeText(sttOutputTextareaEl.value)
                                    .then(() => showStatus('Text copied to clipboard!', 'success', 2000))
                                    .catch(err => showStatus('Failed to copy text.', 'error', 2000));
                            } else {
                                showStatus('Nothing to copy.', 'error', 2000);
                            }
                        };
                    }
                    
                    // Set default language based on browser preference if available
                    const preferredLang = navigator.language || 'en-US';
                    if (Array.from(sttLanguageSelectEl.options).some(opt => opt.value === preferredLang)) {
                        sttLanguageSelectEl.value = preferredLang;
                    } else if (Array.from(sttLanguageSelectEl.options).some(opt => opt.value.startsWith(preferredLang.split('-')[0]))) {
                        const matchedOption = Array.from(sttLanguageSelectEl.options).find(opt => opt.value.startsWith(preferredLang.split('-')[0]));
                        if (matchedOption) sttLanguageSelectEl.value = matchedOption.value;
                    } // else it defaults to en-US from HTML
                    
                    currentToolCleanupFunction = () => {
                        console.log('[STT] Cleanup function called.'); 
                        if (recognition && isListening) { // Only stop if it's actually listening
                            console.log('[STT] Stopping active recognition during cleanup.'); 
                            recognition.onstart = null; 
                            recognition.onresult = null;
                            recognition.onend = null;
                            recognition.onerror = null;
                            recognition.stop();
                        }
                        recognition = null; // Allow garbage collection
                        isListening = false;
                        currentFinalTranscript = '';
                        console.log('[STT] Cleanup complete.'); 
                    };
                    break;

                case 'json-formatter':
                    modalToolContent.innerHTML = `
                        <div class="tool-input-group">
                            <label for="jsonInput-${toolId}">Enter JSON data:</label>
                            <textarea id="jsonInput-${toolId}" rows="8" placeholder="Paste your JSON here..." style="min-height: 150px;"></textarea>
                        </div>
                        <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; margin-top: 0.5rem; flex-wrap:wrap;">
                            <button id="formatJsonBtn-${toolId}" class="tool-ui-button" style="flex-grow:1; min-width: 150px;"><i class="fas fa-align-left"></i> Format JSON</button>
                            <button id="minifyJsonBtn-${toolId}" class="tool-ui-button" style="flex-grow:1; min-width: 150px;"><i class="fas fa-compress-arrows-alt"></i> Minify JSON</button>
                        </div>
                        <div class="tool-input-group">
                            <label for="jsonOutput-${toolId}">Formatted / Minified JSON:</label>
                            <textarea id="jsonOutput-${toolId}" rows="8" readonly placeholder="Output will appear here..." style="min-height: 150px; background-color: var(--main-bg-color);"></textarea>
                        </div>
                        <button id="copyJsonOutputBtn-${toolId}" class="tool-ui-button" style="width:100%; margin-top:0.5rem; display:none;"><i class="fas fa-copy"></i> Copy Output</button>
                    `;

                    const jsonInputEl = document.getElementById(`jsonInput-${toolId}`);
                    const formatJsonBtnEl = document.getElementById(`formatJsonBtn-${toolId}`);
                    const minifyJsonBtnEl = document.getElementById(`minifyJsonBtn-${toolId}`);
                    const jsonOutputEl = document.getElementById(`jsonOutput-${toolId}`);
                    const copyJsonOutputBtnEl = document.getElementById(`copyJsonOutputBtn-${toolId}`);

                    formatJsonBtnEl.onclick = () => {
                        const inputText = jsonInputEl.value.trim();
                        if (!inputText) {
                            showStatus('Please enter JSON data to format.', 'error', 3000);
                            jsonOutputEl.value = '';
                            copyJsonOutputBtnEl.style.display = 'none';
                            return;
                        }
                        try {
                            const parsedJson = JSON.parse(inputText);
                            const formattedJson = JSON.stringify(parsedJson, null, 2); // 2 spaces for indentation
                            jsonOutputEl.value = formattedJson;
                            copyJsonOutputBtnEl.style.display = 'block';
                            showStatus('JSON Formatted successfully!', 'success', 3000);
                        } catch (e) {
                            jsonOutputEl.value = `Error: Invalid JSON.\n${e.message}`;
                            copyJsonOutputBtnEl.style.display = 'none';
                            showStatus(`Invalid JSON: ${e.message}`, 'error', 5000);
                        }
                    };

                    minifyJsonBtnEl.onclick = () => {
                        const inputText = jsonInputEl.value.trim();
                        if (!inputText) {
                            showStatus('Please enter JSON data to minify.', 'error', 3000);
                            jsonOutputEl.value = '';
                            copyJsonOutputBtnEl.style.display = 'none';
                            return;
                        }
                        try {
                            const parsedJson = JSON.parse(inputText);
                            const minifiedJson = JSON.stringify(parsedJson); // No indentation for minifying
                            jsonOutputEl.value = minifiedJson;
                            copyJsonOutputBtnEl.style.display = 'block';
                            showStatus('JSON Minified successfully!', 'success', 3000);
                        } catch (e) {
                            jsonOutputEl.value = `Error: Invalid JSON.\n${e.message}`;
                            copyJsonOutputBtnEl.style.display = 'none';
                            showStatus(`Invalid JSON: ${e.message}`, 'error', 5000);
                        }
                    };

                    copyJsonOutputBtnEl.onclick = () => {
                        if (jsonOutputEl.value && !jsonOutputEl.value.startsWith('Error:')) {
                            navigator.clipboard.writeText(jsonOutputEl.value)
                                .then(() => showStatus('Output copied to clipboard!', 'success', 2000))
                                .catch(err => showStatus('Failed to copy output.', 'error', 2000));
                        } else if (jsonOutputEl.value.startsWith('Error:')) {
                             showStatus('Cannot copy error message.', 'error', 2000);
                        }
                         else {
                            showStatus('Nothing to copy.', 'error', 2000);
                        }
                    };
                    break;


                default:
                    console.warn(`Unrecognized toolId: ${toolId}`);
                    modalToolContent.innerHTML = `<p>Tool "${toolName}" UI is not yet implemented or the tool ID is unrecognized.</p>`;
            }
        } // End of loadToolUI
    }); // End of DOMContentLoaded
</script>
</body>
</html>
